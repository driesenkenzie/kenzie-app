<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kenzie - Smart Business Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0f0f1a;
            color: #e2e8f0;
            overflow-x: hidden;
        }
        
        .font-display {
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .bg-mesh {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(236, 72, 153, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 0% 100%, rgba(236, 72, 153, 0.15) 0px, transparent 50%),
                #0f0f1a;
            animation: meshMove 20s ease infinite;
        }
        
        @keyframes meshMove {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(2deg); }
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .glass-strong {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.6); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .animate-slide-up {
            animation: slideUp 0.6s ease-out forwards;
        }
        
        .animate-slide-in {
            animation: slideIn 0.4s ease-out forwards;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.5);
            border-radius: 4px;
        }
        
        .input-glow {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .input-glow:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.8);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .hover-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(99, 102, 241, 0.3);
        }
        
        .search-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: rgba(20, 20, 35, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .search-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .modal {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: rgba(25, 25, 40, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
            opacity: 1;
        }
        
        .badge-pulse {
            animation: pulse-glow 2s infinite;
        }
        
        .product-row {
            transition: all 0.3s ease;
        }
        
        .product-row:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(5px);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .stock-alert {
            animation: shake 0.5s ease-in-out;
            border: 1px solid rgba(239, 68, 68, 0.5);
            background: rgba(239, 68, 68, 0.1);
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .nav-item {
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 0;
            background: linear-gradient(180deg, #6366f1, #8b5cf6);
            transition: height 0.3s ease;
            border-radius: 0 3px 3px 0;
        }
        
        .nav-item:hover::before,
        .nav-item.active::before {
            height: 70%;
        }
        
        .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: #818cf8;
        }
        
        /* FIX: Remove white background from nav-item icons */
        .nav-item i {
            background: transparent !important;
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #6366f1;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 99999;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .social-float-container {
            position: fixed;
            bottom: 30px;
            left: 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 999;
        }
        
        .social-float {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            border: none;
        }
        
        .social-float:hover {
            transform: scale(1.15) rotate(10deg);
        }
        
        .whatsapp-float {
            background: #25d366;
            box-shadow: 0 10px 30px rgba(37, 211, 102, 0.4);
            animation: float 3s ease-in-out infinite;
        }
        
        .whatsapp-float:hover {
            box-shadow: 0 15px 40px rgba(37, 211, 102, 0.6);
        }
        
        .snapchat-float {
            background: #FFFC00;
            box-shadow: 0 10px 30px rgba(255, 252, 0, 0.4);
            animation: float 3s ease-in-out infinite;
            animation-delay: 0.5s;
        }
        
        .snapchat-float:hover {
            box-shadow: 0 15px 40px rgba(255, 252, 0, 0.6);
        }
        
        .snapchat-float i {
            color: #000 !important;
            font-size: 28px;
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .number-control {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .number-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #94a3b8;
            user-select: none;
            border: none;
            background: transparent;
        }
        
        .number-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            color: #818cf8;
        }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            cursor: pointer;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: slideUp 0.4s ease-out;
        }
        
        button, a, select, input, .clickable, .nav-item {
            cursor: pointer;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        
        .empty-state-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: #4b5563;
        }

        /* Order card styles */
        .order-card {
            transition: all 0.3s ease;
        }
        .order-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* Report notification styles */
        .report-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            z-index: 99999;
        }

        /* Upload area styles */
        .upload-area {
            border: 2px dashed rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-area:hover {
            border-color: rgba(99, 102, 241, 0.6);
            background: rgba(99, 102, 241, 0.05);
        }
        .upload-area.dragover {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
        }

        /* Promocode valid/invalid states */
        .promo-valid {
            border-color: #10b981 !important;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2) !important;
        }
        .promo-invalid {
            border-color: #ef4444 !important;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.2) !important;
        }

        /* CIRCULAR PROGRESS STYLES */
        .circular-progress {
            position: relative;
            width: 160px;
            height: 160px;
        }
        
        .circular-progress svg {
            transform: rotate(-90deg);
        }
        
        .circular-progress-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 10;
        }
        
        .circular-progress-bar {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease-in-out;
        }
        
        .circular-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .goal-card {
            transition: all 0.3s ease;
        }
        
        .goal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .goal-icon-btn {
            transition: all 0.2s ease;
        }
        
        .goal-icon-btn.active {
            background: rgba(99, 102, 241, 0.3);
            color: #818cf8;
            border-color: rgba(99, 102, 241, 0.5);
        }
        
        .goal-color-btn.active {
            ring-color: white !important;
            transform: scale(1.1);
        }
        
        .split-color-btn.active {
            ring-color: white !important;
            transform: scale(1.1);
        }
        
        /* DONUT CHART STYLES */
        .donut-segment {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .donut-segment:hover {
            opacity: 0.8;
            transform: scale(1.02);
            transform-origin: center;
        }
        
        .legend-item {
            transition: all 0.2s ease;
        }
        
        .legend-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* CONFETTI ANIMATION */
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100%) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 9999;
            animation: confetti-fall 3s ease-out forwards;
        }
        
        /* Goal completed animation */
        @keyframes goal-completed {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .goal-completed {
            animation: goal-completed 0.5s ease-in-out;
        }

        /* CUSTOMER LEVEL STYLES */
        .level-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #000;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .xp-progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .xp-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="antialiased">

    <div class="bg-mesh"></div>

    <div class="flex h-screen overflow-hidden">
        
        <aside class="w-72 glass-strong flex flex-col animate-slide-in z-50">
            <div class="p-6 border-b border-white/10">
                <div class="flex items-center gap-3 animate-float" onclick="switchTab('orders')" style="cursor: pointer;">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/30 hover:scale-110 transition-transform">
                        <span class="text-2xl font-bold text-white font-display">K</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold font-display tracking-tight text-white">Kenzie</h1>
                        <p class="text-xs text-gray-400 uppercase tracking-widest">Business Hub</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4 px-4">Menu</div>
                
                <div class="nav-item active flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all" onclick="switchTab('orders')" data-tab="orders">
                    <i class="fas fa-shopping-cart w-5 text-center"></i>
                    <span>Nieuwe Bestelling</span>
                </div>
                
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('customers')" data-tab="customers">
                    <i class="fas fa-users w-5 text-center"></i>
                    <span>Klanten</span>
                    <span class="ml-auto bg-indigo-500/20 text-indigo-300 text-xs px-2 py-1 rounded-full" id="customerCount">0</span>
                </div>
                
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('products')" data-tab="products">
                    <i class="fas fa-box w-5 text-center"></i>
                    <span>Producten</span>
                    <span class="ml-auto bg-pink-500/20 text-pink-300 text-xs px-2 py-1 rounded-full" id="productCount">0</span>
                </div>
                
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('inventory')" data-tab="inventory">
                    <i class="fas fa-warehouse w-5 text-center"></i>
                    <span>Voorraad</span>
                    <span class="ml-auto bg-amber-500/20 text-amber-300 text-xs px-2 py-1 rounded-full" id="inventoryBadge">0</span>
                </div>
                
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('promocodes')" data-tab="promocodes">
                    <i class="fas fa-tag w-5 text-center"></i>
                    <span>Promocodes</span>
                    <span class="ml-auto bg-emerald-500/20 text-emerald-300 text-xs px-2 py-1 rounded-full" id="promocodeCount">0</span>
                </div>
                
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('analytics')" data-tab="analytics">
                    <i class="fas fa-chart-line w-5 text-center"></i>
                    <span>Analytics</span>
                </div>
                
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('invoices')" data-tab="invoices">
                    <i class="fas fa-file-invoice w-5 text-center"></i>
                    <span>Facturen</span>
                    <span class="ml-auto bg-emerald-500/20 text-emerald-300 text-xs px-2 py-1 rounded-full" id="invoiceCount">0</span>
                </div>

                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider mt-8 mb-4 px-4">Financieel</div>
                
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('goals')" data-tab="goals">
                    <i class="fas fa-trophy w-5 text-center"></i>
                    <span>Doelstellingen</span>
                    <span class="ml-auto bg-yellow-500/20 text-yellow-300 text-xs px-2 py-1 rounded-full" id="activeGoalsCount">0</span>
                </div>
                
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('profitSplit')" data-tab="profitSplit">
                    <i class="fas fa-chart-pie w-5 text-center"></i>
                    <span>Winstverdeling</span>
                </div>

                <!-- KLANTEN LEVELS NAV ITEM -->
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('customerLevels')" data-tab="customerLevels">
                    <i class="fas fa-star w-5 text-center"></i>
                    <span>Klanten Levels</span>
                    <span class="ml-auto bg-amber-500/20 text-amber-300 text-xs px-2 py-1 rounded-full" id="customerLevelsBadge">XP</span>
                </div>

                <!-- LEADERBOARD NAV ITEM -->
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('leaderboard')" data-tab="leaderboard">
                    <i class="fas fa-medal w-5 text-center"></i>
                    <span>Leaderboard</span>
                    <span class="ml-auto bg-purple-500/20 text-purple-300 text-xs px-2 py-1 rounded-full">RANK</span>
                </div>

                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider mt-8 mb-4 px-4">Marketing</div>
                
                <a href="https://web.snapchat.com" target="_blank" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-[#FFFC00] text-sm font-medium transition-all group">
                    <i class="fab fa-snapchat w-5 text-center group-hover:text-[#FFFC00]"></i>
                    <span>Snapchat Web</span>
                </a>
                
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider mt-8 mb-4 px-4">Instellingen</div>
                
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('settings')" data-tab="settings">
                    <i class="fas fa-cog w-5 text-center"></i>
                    <span>Configuratie</span>
                </div>

                <!-- LEVEL CONFIGURATIE NAV ITEM -->
                <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white text-sm font-medium transition-all" onclick="switchTab('levelConfig')" data-tab="levelConfig">
                    <i class="fas fa-sliders-h w-5 text-center"></i>
                    <span>Level Configuratie</span>
                </div>
            </nav>

            <div class="p-4 border-t border-white/10">
                <div class="glass rounded-xl p-4 flex items-center gap-3 hover-card">
                    <img src="https://ui-avatars.com/api/?name=Admin+User&background=6366f1&color=fff" alt="User" class="w-10 h-10 rounded-full border-2 border-indigo-500/30">
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-white truncate">Admin User</p>
                        <p class="text-xs text-gray-400 truncate">admin@kenzie.be</p>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 overflow-hidden flex flex-col relative">
            
            <header class="glass border-b border-white/10 px-8 py-4 flex items-center justify-between animate-slide-up relative z-40">
                <div class="flex items-center gap-4 flex-1">
                    <h2 class="text-xl font-semibold text-white font-display" id="pageTitle">Nieuwe Bestelling</h2>
                    <span class="px-3 py-1 rounded-full bg-indigo-500/10 text-indigo-300 text-xs border border-indigo-500/20">
                        <i class="fas fa-circle text-[8px] mr-1 animate-pulse"></i> Live
                    </span>
                </div>

                <div class="flex items-center gap-4">
                    <div class="relative" style="z-index: 1000;">
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400 group-focus-within:text-indigo-400 transition-colors"></i>
                            </div>
                            <input type="text" 
                                   id="globalSearch"
                                   placeholder="Zoek..." 
                                   class="input-glow w-80 pl-11 pr-4 py-2.5 rounded-xl text-sm text-white placeholder-gray-500 focus:w-96 transition-all duration-300"
                                   autocomplete="off">
                        </div>
                        <div id="searchResults" class="search-dropdown">
                            <div class="p-3 text-xs text-gray-500 uppercase tracking-wider font-semibold border-b border-white/10">Resultaten</div>
                            <div id="searchResultsList"></div>
                        </div>
                    </div>

                    <button class="relative p-2.5 rounded-xl hover:bg-white/5 transition-all group" onclick="showNotifications()">
                        <i class="fas fa-bell text-gray-400 group-hover:text-white text-lg transition-colors"></i>
                        <span id="notificationBadge" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs flex items-center justify-center text-white hidden">0</span>
                    </button>

                    <button class="btn-primary px-4 py-2.5 rounded-xl text-sm font-medium text-white flex items-center gap-2 shadow-lg shadow-indigo-500/25" onclick="showQuickMenu()">
                        <i class="fas fa-plus"></i>
                        <span class="hidden sm:inline">Nieuw</span>
                    </button>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-8 relative">
                
                <div id="orders" class="tab-content active max-w-7xl mx-auto space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 animate-slide-up">
                        <div class="glass rounded-2xl p-6 hover-card" onclick="switchTab('analytics')">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg">
                                    <i class="fas fa-euro-sign text-white text-lg"></i>
                                </div>
                                <span class="text-xs text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded-full" id="revenueChange">+0%</span>
                            </div>
                            <p class="text-gray-400 text-sm mb-1">Omzet Vandaag</p>
                            <h3 class="text-2xl font-bold text-white font-display" id="todayRevenue">€0,00</h3>
                        </div>

                        <div class="glass rounded-2xl p-6 hover-card" onclick="switchTab('orders')">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg">
                                    <i class="fas fa-shopping-bag text-white text-lg"></i>
                                </div>
                                <span class="text-xs text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded-full" id="orderChange">+0%</span>
                            </div>
                            <p class="text-gray-400 text-sm mb-1">Bestellingen</p>
                            <h3 class="text-2xl font-bold text-white font-display" id="totalOrders">0</h3>
                        </div>

                        <div class="glass rounded-2xl p-6 hover-card" onclick="switchTab('customers')">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center shadow-lg">
                                    <i class="fas fa-users text-white text-lg"></i>
                                </div>
                                <span class="text-xs text-gray-400">Totaal</span>
                            </div>
                            <p class="text-gray-400 text-sm mb-1">Actieve Klanten</p>
                            <h3 class="text-2xl font-bold text-white font-display" id="totalCustomers">0</h3>
                        </div>

                        <div class="glass rounded-2xl p-6 hover-card relative overflow-hidden" onclick="switchTab('inventory')">
                            <div class="absolute inset-0 bg-gradient-to-br from-amber-500/10 to-orange-600/10 opacity-0 hover:opacity-100 transition-opacity"></div>
                            <div class="flex items-center justify-between mb-4 relative z-10">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg">
                                    <i class="fas fa-exclamation-triangle text-white text-lg"></i>
                                </div>
                                <span class="text-xs text-amber-400 bg-amber-500/10 px-2 py-1 rounded-full">Alert</span>
                            </div>
                            <p class="text-gray-400 text-sm mb-1 relative z-10">Lage Voorraad</p>
                            <h3 class="text-2xl font-bold text-white font-display relative z-10" id="lowStockCount">0 items</h3>
                        </div>
                    </div>

                    <div class="glass rounded-2xl p-8 animate-slide-up" style="animation-delay: 0.1s;">
                        <form id="orderForm" class="space-y-6" onsubmit="handleOrderSubmit(event)">
                            <div class="space-y-4">
                                <div class="flex items-center gap-3 mb-6">
                                    <div class="w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center">
                                        <i class="fas fa-user text-indigo-400"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-white font-display">Klantgegevens</h3>
                                        <p class="text-sm text-gray-400">Selecteer een klant of voeg een nieuwe toe</p>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="space-y-2">
                                        <label class="text-sm font-medium text-gray-300">Klant <span class="text-red-400">*</span></label>
                                        <select id="customerSelect" class="input-glow w-full px-4 py-3 rounded-xl text-white" onchange="handleCustomerChange(this.value)">
                                            <option value="" class="bg-[#1a1a2e]">Selecteer klant...</option>
                                        </select>
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-sm font-medium text-gray-300">Klantnummer</label>
                                        <input type="text" readonly class="input-glow w-full px-4 py-3 rounded-xl text-gray-500 bg-white/5" id="customerNumber">
                                    </div>
                                </div>

                                <div id="newCustomerFields" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 p-4 rounded-xl bg-white/5 border border-white/10 animate-slide-up">
                                    <div class="space-y-2">
                                        <label class="text-sm font-medium text-gray-300">Naam *</label>
                                        <input type="text" id="newCustomerName" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="Volledige naam">
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-sm font-medium text-gray-300">Email *</label>
                                        <input type="email" id="newCustomerEmail" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="email@voorbeeld.be">
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-sm font-medium text-gray-300">Telefoon</label>
                                        <input type="tel" id="newCustomerPhone" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="+32 ...">
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-sm font-medium text-gray-300">Adres</label>
                                        <input type="text" id="newCustomerAddress" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="Straat, nummer, stad">
                                    </div>
                                </div>

                                <!-- Customer Level Info -->
                                <div id="customerLevelInfo" class="hidden p-4 rounded-xl bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20 animate-slide-up">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-xl bg-amber-500/20 flex items-center justify-center">
                                                <i class="fas fa-star text-amber-400"></i>
                                            </div>
                                            <div>
                                                <h4 class="text-white font-medium" id="customerLevelName">Level 1: Starter</h4>
                                                <span class="text-xs text-amber-400" id="customerLevelBadge">⭐ LVL 1</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between text-sm">
                                            <span class="text-gray-400">Voortgang</span>
                                            <span class="text-white" id="customerXPText">0 XP / 100 XP</span>
                                        </div>
                                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                            <div id="customerXPBar" class="h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div id="customerRewardInfo" class="hidden mt-3 p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20">
                                        <p class="text-sm text-emerald-400 flex items-center gap-2">
                                            <i class="fas fa-gift"></i>
                                            <span id="customerRewardText">Beloning beschikbaar!</span>
                                        </p>
                                    </div>
                                </div>

                                <!-- XP Earn Info -->
                                <div id="xpEarnInfo" class="hidden p-3 rounded-lg bg-indigo-500/10 border border-indigo-500/20">
                                    <p class="text-sm text-indigo-400 flex items-center gap-2">
                                        <i class="fas fa-bolt"></i>
                                        <span id="xpEarnText">Deze klant verdient 0 XP voor deze bestelling!</span>
                                    </p>
                                </div>
                            </div>

                            <div class="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent my-8"></div>

                            <div class="space-y-4">
                                <div class="flex items-center justify-between mb-6">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center">
                                            <i class="fas fa-box text-purple-400"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-semibold text-white font-display">Producten</h3>
                                            <p class="text-sm text-gray-400">Voeg producten toe aan de bestelling</p>
                                        </div>
                                    </div>
                                    <button type="button" onclick="addProductRow()" class="px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-indigo-400 text-sm font-medium transition-all flex items-center gap-2 border border-indigo-500/30 hover:border-indigo-500/60">
                                        <i class="fas fa-plus"></i> Product toevoegen
                                    </button>
                                </div>

                                <div id="productList" class="space-y-3"></div>

                                <div id="emptyState" class="text-center py-12 rounded-xl border-2 border-dashed border-white/10">
                                    <div class="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-box-open text-2xl text-gray-500"></i>
                                    </div>
                                    <p class="text-gray-400 mb-2">Geen producten toegevoegd</p>
                                    <button type="button" onclick="addProductRow()" class="text-indigo-400 hover:text-indigo-300 text-sm font-medium transition-colors">
                                        + Eerste product toevoegen
                                    </button>
                                </div>
                            </div>

                            <!-- PROMOCODE SECTION -->
                            <div class="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent my-8"></div>

                            <div class="space-y-4">
                                <div class="flex items-center gap-3 mb-6">
                                    <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                                        <i class="fas fa-tag text-emerald-400"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-white font-display">Promocode</h3>
                                        <p class="text-sm text-gray-400">Voeg een kortingscode toe (optioneel). Gebruik "KENZIE" voor persoonlijk gebruik (geen winst)</p>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="md:col-span-2">
                                        <input type="text" 
                                               id="promocodeInput" 
                                               class="input-glow w-full px-4 py-3 rounded-xl text-white uppercase" 
                                               placeholder="Voer promocode in (bijv. WELKOM10 of KENZIE)"
                                               oninput="validatePromocode(this.value)"
                                               autocomplete="off">
                                    </div>
                                    <div class="flex items-center">
                                        <span id="promocodeStatus" class="text-sm"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="glass-strong rounded-xl p-6 space-y-3 mt-8">
                                <div class="flex justify-between items-center text-sm">
                                    <span class="text-gray-400">Subtotaal</span>
                                    <span class="text-white font-medium" id="subtotal">€0,00</span>
                                </div>
                                <div id="discountRow" class="flex justify-between items-center text-sm hidden">
                                    <span class="text-emerald-400">Korting <span id="promocodeName" class="text-xs bg-emerald-500/20 px-2 py-0.5 rounded ml-1"></span></span>
                                    <span class="text-emerald-400 font-medium" id="discountAmount">-€0,00</span>
                                </div>
                                <div class="h-px bg-white/10 my-2"></div>
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-semibold text-white font-display">Totaal</span>
                                    <span class="text-3xl font-bold text-gradient font-display" id="total">€0,00</span>
                                </div>
                            </div>

                            <div class="flex items-center justify-end gap-4 pt-4">
                                <button type="button" class="px-6 py-3 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-all text-sm font-medium" onclick="resetForm()">
                                    Annuleren
                                </button>
                                <button type="submit" class="btn-primary px-8 py-3 rounded-xl text-white font-medium shadow-lg shadow-indigo-500/25 flex items-center gap-2">
                                    <span>Bestelling Plaatsen</span>
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="glass rounded-2xl p-6 animate-slide-up" style="animation-delay: 0.2s;">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-white font-display">Recente Bestellingen</h3>
                            <button onclick="clearAllOrders()" class="text-xs text-red-400 hover:text-red-300 transition-colors">
                                <i class="fas fa-trash mr-1"></i>Alles wissen
                            </button>
                        </div>
                        <div id="recentOrdersList">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-shopping-bag"></i>
                                </div>
                                <h4 class="text-lg font-medium text-white mb-2">Nog geen bestellingen</h4>
                                <p class="text-sm text-gray-400 mb-4">Je eerste bestelling verschijnt hier</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="customers" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Klantenbeheer</h3>
                                <p class="text-gray-400">Beheer je klanten</p>
                            </div>
                            <button class="btn-primary px-6 py-3 rounded-xl text-white font-medium flex items-center gap-2" onclick="openCustomerModal()">
                                <i class="fas fa-plus"></i>
                                Nieuwe Klant
                            </button>
                        </div>

                        <div id="customersGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="empty-state col-span-full">
                                <div class="empty-state-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h4 class="text-lg font-medium text-white mb-2">Geen klanten</h4>
                                <p class="text-sm text-gray-400 mb-4">Voeg je eerste klant toe</p>
                                <button onclick="openCustomerModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-medium">
                                    <i class="fas fa-plus mr-2"></i>Klant Toevoegen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="products" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Productcatalogus</h3>
                                <p class="text-gray-400">Beheer je producten</p>
                            </div>
                            <button class="btn-primary px-6 py-3 rounded-xl text-white font-medium flex items-center gap-2" onclick="openProductModal()">
                                <i class="fas fa-plus"></i>
                                Nieuw Product
                            </button>
                        </div>

                        <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="empty-state col-span-full">
                                <div class="empty-state-icon">
                                    <i class="fas fa-box"></i>
                                </div>
                                <h4 class="text-lg font-medium text-white mb-2">Geen producten</h4>
                                <p class="text-sm text-gray-400 mb-4">Voeg je eerste product toe</p>
                                <button onclick="openProductModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-medium">
                                    <i class="fas fa-plus mr-2"></i>Product Toevoegen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inventory" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Voorraadbeheer</h3>
                                <p class="text-gray-400">Monitor je voorraad</p>
                            </div>
                            <div class="flex gap-3">
                                <button class="px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 text-sm font-medium transition-all" onclick="exportInventory()">
                                    <i class="fas fa-download mr-2"></i>Export
                                </button>
                            </div>
                        </div>

                        <div id="lowStockBanner" class="hidden bg-red-500/10 border border-red-500/20 rounded-xl p-4 mb-6 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-red-400"></i>
                                </div>
                                <div>
                                    <h4 class="text-white font-medium">Producten hebben lage voorraad</h4>
                                    <p class="text-sm text-gray-400">WhatsApp: +32 0470281020</p>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead>
                                    <tr class="text-xs text-gray-500 uppercase tracking-wider border-b border-white/10">
                                        <th class="pb-3 font-medium">Product</th>
                                        <th class="pb-3 font-medium">SKU</th>
                                        <th class="pb-3 font-medium text-center">Voorraad</th>
                                        <th class="pb-3 font-medium text-center">Minimum</th>
                                        <th class="pb-3 font-medium text-center">Status</th>
                                        <th class="pb-3 font-medium text-right">Acties</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryTable">
                                    <tr>
                                        <td colspan="6" class="py-12 text-center text-gray-400">
                                            <div class="empty-state-icon mx-auto mb-4" style="width: 60px; height: 60px; font-size: 24px;">
                                                <i class="fas fa-warehouse"></i>
                                            </div>
                                            <p>Geen producten in voorraad</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PROMOCODES TAB -->
                <div id="promocodes" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Promocodes</h3>
                                <p class="text-gray-400">Beheer kortingscodes voor klanten</p>
                            </div>
                            <button class="btn-primary px-6 py-3 rounded-xl text-white font-medium flex items-center gap-2" onclick="openPromocodeModal()">
                                <i class="fas fa-plus"></i>
                                Nieuwe Code
                            </button>
                        </div>

                        <div id="promocodesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="empty-state col-span-full">
                                <div class="empty-state-icon">
                                    <i class="fas fa-tag"></i>
                                </div>
                                <h4 class="text-lg font-medium text-white mb-2">Geen promocodes</h4>
                                <p class="text-sm text-gray-400 mb-4">Maak je eerste kortingscode aan</p>
                                <button onclick="openPromocodeModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-medium">
                                    <i class="fas fa-plus mr-2"></i>Code Aanmaken
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="analytics" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Analytics Dashboard</h3>
                                <p class="text-gray-400">Bekijk statistieken</p>
                            </div>
                            <button onclick="generateWeeklyReport()" class="px-4 py-2 rounded-xl bg-indigo-500/20 hover:bg-indigo-500/30 text-indigo-300 text-sm font-medium transition-all">
                                <i class="fas fa-file-alt mr-2"></i>Wekelijks Rapport
                            </button>
                        </div>

                        <div id="analyticsContent">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <h4 class="text-lg font-medium text-white mb-2">Nog geen data</h4>
                                <p class="text-sm text-gray-400 mb-4">Statistieken verschijnen hier zodra je bestellingen plaatst</p>
                            </div>
                        </div>

                        <div id="analyticsCharts" class="hidden space-y-6 mt-8">
                            <!-- Profit & Expenses Overview Cards -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                                <div class="glass rounded-xl p-6 hover-card">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center shadow-lg">
                                            <i class="fas fa-coins text-white text-lg"></i>
                                        </div>
                                        <span class="text-xs text-gray-400">Totaal</span>
                                    </div>
                                    <p class="text-gray-400 text-sm mb-1">Winst</p>
                                    <h3 class="text-2xl font-bold text-emerald-400 font-display" id="totalProfit">€0,00</h3>
                                </div>
                                <div class="glass rounded-xl p-6 hover-card">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-rose-500 to-rose-600 flex items-center justify-center shadow-lg">
                                            <i class="fas fa-shopping-cart text-white text-lg"></i>
                                        </div>
                                        <span class="text-xs text-gray-400">Totaal</span>
                                    </div>
                                    <p class="text-gray-400 text-sm mb-1">Uitgaven (Inkoop)</p>
                                    <h3 class="text-2xl font-bold text-rose-400 font-display" id="totalExpenses">€0,00</h3>
                                </div>
                                <div class="glass rounded-xl p-6 hover-card">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg">
                                            <i class="fas fa-euro-sign text-white text-lg"></i>
                                        </div>
                                        <span class="text-xs text-gray-400">Totaal</span>
                                    </div>
                                    <p class="text-gray-400 text-sm mb-1">Omzet</p>
                                    <h3 class="text-2xl font-bold text-white font-display" id="totalRevenue">€0,00</h3>
                                </div>
                                <div class="glass rounded-xl p-6 hover-card">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg">
                                            <i class="fas fa-percentage text-white text-lg"></i>
                                        </div>
                                        <span class="text-xs text-gray-400">Gemiddeld</span>
                                    </div>
                                    <p class="text-gray-400 text-sm mb-1">Winstmarge</p>
                                    <h3 class="text-2xl font-bold text-purple-400 font-display" id="profitMargin">0%</h3>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="glass rounded-xl p-6">
                                    <h4 class="text-lg font-semibold text-white mb-4">Verkopen per Dag</h4>
                                    <div id="salesByDay" class="space-y-3"></div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <h4 class="text-lg font-semibold text-white mb-4">Top Producten</h4>
                                    <div id="topProducts" class="space-y-3"></div>
                                </div>
                            </div>
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Wekelijkse Samenvatting</h4>
                                <div id="weeklySummary" class="grid grid-cols-1 md:grid-cols-4 gap-4"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="invoices" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Facturen</h3>
                                <p class="text-gray-400">Beheer facturen</p>
                            </div>
                            <button class="btn-primary px-6 py-3 rounded-xl text-white font-medium flex items-center gap-2" onclick="openInvoiceModal()">
                                <i class="fas fa-plus"></i>
                                Nieuwe Factuur
                            </button>
                        </div>

                        <div id="invoicesList" class="space-y-4">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                                <h4 class="text-lg font-medium text-white mb-2">Geen facturen</h4>
                                <p class="text-sm text-gray-400 mb-4">Maak je eerste factuur</p>
                                <button onclick="openInvoiceModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-medium">
                                    <i class="fas fa-plus mr-2"></i>Factuur Maken
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settings" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="mb-8">
                            <h3 class="text-2xl font-bold text-white font-display mb-2">Instellingen</h3>
                            <p class="text-gray-400">Configureer Kenzie</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-bell text-indigo-400"></i>
                                    Notificaties
                                </h4>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-white text-sm">WhatsApp Alerts</p>
                                            <p class="text-xs text-gray-400">+32 0470281020</p>
                                        </div>
                                        <button onclick="toggleSetting(this, 'whatsapp')" class="w-12 h-6 rounded-full bg-indigo-500 relative transition-colors">
                                            <div class="w-5 h-5 rounded-full bg-white absolute right-0.5 top-0.5 shadow-md transition-transform"></div>
                                        </button>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-white text-sm">Email Notificaties</p>
                                            <p class="text-xs text-gray-400">admin@kenzie.be</p>
                                        </div>
                                        <button onclick="toggleSetting(this, 'email')" class="w-12 h-6 rounded-full bg-indigo-500 relative transition-colors">
                                            <div class="w-5 h-5 rounded-full bg-white absolute right-0.5 top-0.5 shadow-md transition-transform"></div>
                                        </button>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-white text-sm">Wekelijks Rapport</p>
                                            <p class="text-xs text-gray-400">Elke zondag om 20:00</p>
                                        </div>
                                        <button onclick="toggleSetting(this, 'weeklyReport')" class="w-12 h-6 rounded-full bg-indigo-500 relative transition-colors" id="weeklyReportToggle">
                                            <div class="w-5 h-5 rounded-full bg-white absolute right-0.5 top-0.5 shadow-md transition-transform"></div>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="glass rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <i class="fab fa-snapchat text-[#FFFC00]"></i>
                                    Snapchat Ads
                                </h4>
                                <a href="https://web.snapchat.com" target="_blank" class="block w-full py-3 rounded-xl bg-[#FFFC00] text-black font-medium text-center hover:bg-[#e6e300] transition-colors mb-3">
                                    <i class="fab fa-snapchat mr-2"></i>Open Snapchat Web
                                </a>
                            </div>

                            <div class="glass rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-database text-rose-400"></i>
                                    Data
                                </h4>
                                <button class="w-full py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 text-sm mb-2 transition-colors" onclick="backupData()">
                                    <i class="fas fa-download mr-2"></i>Backup Maken
                                </button>
                                
                                <!-- UPLOAD BACKUP SECTION -->
                                <div class="upload-area mt-4" onclick="document.getElementById('backupUpload').click()" ondrop="handleBackupDrop(event)" ondragover="handleBackupDragOver(event)" ondragleave="handleBackupDragLeave(event)">
                                    <input type="file" id="backupUpload" accept=".json" style="display: none;" onchange="handleBackupUpload(event)">
                                    <i class="fas fa-cloud-upload-alt text-3xl text-indigo-400 mb-2"></i>
                                    <p class="text-sm text-gray-300">Klik of sleep backup hier</p>
                                    <p class="text-xs text-gray-500 mt-1">JSON bestanden</p>
                                </div>
                                
                                <button class="w-full py-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 text-sm transition-colors mt-4" onclick="clearAllData()">
                                    <i class="fas fa-trash mr-2"></i>Alles Wissen
                                </button>
                            </div>

                            <div class="glass rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <i class="fab fa-whatsapp text-green-400"></i>
                                    WhatsApp Configuratie
                                </h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="text-xs text-gray-400">Jouw WhatsApp Nummer</label>
                                        <input type="tel" id="whatsappNumber" class="input-glow w-full px-3 py-2 rounded-lg text-white text-sm mt-1" placeholder="+32 0470281020" value="+32 0470281020">
                                    </div>
                                    <button onclick="testWhatsApp()" class="w-full py-2 rounded-lg bg-green-500/20 hover:bg-green-500/30 text-green-400 text-sm transition-colors">
                                        <i class="fab fa-whatsapp mr-2"></i>Test Verbinding
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DOELSTELLINGEN TAB - LEVEL SYSTEEM -->
                <div id="goals" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Winst Levels</h3>
                                <p class="text-gray-400">Bereik nieuwe niveaus door winst te maken!</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <button onclick="resetProfitGoals()" class="px-4 py-2 rounded-xl bg-red-500/10 hover:bg-red-500/20 text-red-400 text-sm font-medium transition-all">
                                    <i class="fas fa-undo mr-2"></i>Reset Doelstellingen
                                </button>
                                <div class="text-right">
                                    <p class="text-sm text-gray-400">Huidige Winst</p>
                                    <h3 class="text-3xl font-bold text-emerald-400 font-display" id="goalsCurrentProfit">€0,00</h3>
                                </div>
                            </div>
                        </div>

                        <!-- Current Level Card -->
                        <div id="currentLevelCard" class="mb-8">
                            <!-- Current level info will be rendered here -->
                        </div>

                        <!-- Progress Bar to Next Level -->
                        <div class="glass rounded-xl p-6 mb-8">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-gray-400">Voortgang naar volgend level</span>
                                <span class="text-white font-medium" id="nextLevelProgress">0%</span>
                            </div>
                            <div class="h-4 bg-white/10 rounded-full overflow-hidden">
                                <div id="levelProgressBar" class="h-full bg-gradient-to-r from-emerald-400 to-emerald-600 rounded-full transition-all duration-1000" style="width: 0%"></div>
                            </div>
                            <p class="text-center text-gray-400 mt-3" id="nextLevelText">Nog €100 tot Level 2</p>
                        </div>

                        <!-- Levels Timeline -->
                        <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-layer-group text-yellow-400"></i>
                            Level Tijdlijn
                        </h4>
                        <div id="levelsTimeline" class="space-y-4">
                            <!-- Levels will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- WINSTVERDELING TAB -->
                <div id="profitSplit" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Winstverdeling</h3>
                                <p class="text-gray-400">Beheer hoe je je winst verdeelt</p>
                            </div>
                            <button class="btn-primary px-6 py-3 rounded-xl text-white font-medium flex items-center gap-2" onclick="openProfitSplitModal()">
                                <i class="fas fa-plus"></i>
                                Nieuwe Categorie
                            </button>
                        </div>

                        <!-- Profit Split Overview -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <!-- Donut Chart Section -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Verdelingsoverzicht</h4>
                                <div class="flex items-center justify-center">
                                    <div class="relative" style="width: 280px; height: 280px;">
                                        <svg id="profitDonutChart" viewBox="0 0 200 200" class="w-full h-full transform -rotate-90">
                                            <!-- Donut segments will be rendered here -->
                                        </svg>
                                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                                            <span class="text-gray-400 text-sm">Totaal</span>
                                            <span class="text-2xl font-bold text-white" id="totalProfitSplit">100%</span>
                                        </div>
                                    </div>
                                </div>
                                <div id="profitSplitLegend" class="mt-6 space-y-2">
                                    <!-- Legend items will be rendered here -->
                                </div>
                            </div>

                            <!-- Current Distribution Stats -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Huidige Verdeling</h4>
                                <div id="profitSplitStats" class="space-y-4">
                                    <div class="empty-state">
                                        <div class="empty-state-icon" style="width: 60px; height: 60px; font-size: 24px;">
                                            <i class="fas fa-chart-pie"></i>
                                        </div>
                                        <p class="text-gray-400">Geen categorieën toegevoegd</p>
                                    </div>
                                </div>
                                
                                <!-- Profit Simulation -->
                                <div class="mt-8 p-4 rounded-xl bg-white/5 border border-white/10">
                                    <h5 class="text-white font-medium mb-3">Winst Simulatie</h5>
                                    <div class="flex items-center gap-4 mb-4">
                                        <input type="number" id="simulationAmount" class="input-glow flex-1 px-4 py-2 rounded-lg text-white" placeholder="Bedrag (€)" oninput="updateProfitSimulation()">
                                        <span class="text-gray-400">€</span>
                                    </div>
                                    <div id="simulationResults" class="space-y-2">
                                        <!-- Simulation results will be rendered here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Categories List -->
                        <div class="glass rounded-xl p-6">
                            <h4 class="text-lg font-semibold text-white mb-4">Categorieën</h4>
                            <div id="profitSplitList" class="space-y-3">
                                <div class="empty-state">
                                    <div class="empty-state-icon" style="width: 60px; height: 60px; font-size: 24px;">
                                        <i class="fas fa-list"></i>
                                    </div>
                                    <p class="text-gray-400">Geen categorieën toegevoegd</p>
                                    <button onclick="openProfitSplitModal()" class="btn-primary px-4 py-2 rounded-lg text-white text-sm mt-4">
                                        <i class="fas fa-plus mr-2"></i>Categorie Toevoegen
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KLANTEN LEVELS TAB -->
                <div id="customerLevels" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Klanten Levels</h3>
                                <p class="text-gray-400">Bekijk klanten en hun XP voortgang</p>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="resetAllCustomerXP()" class="px-4 py-2 rounded-xl bg-red-500/10 hover:bg-red-500/20 text-red-400 text-sm font-medium transition-all">
                                    <i class="fas fa-undo mr-2"></i>Reset Alle XP
                                </button>
                            </div>
                        </div>

                        <!-- Customer Levels Overview -->
                        <div id="customerLevelsOverview" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <!-- Stats cards will be rendered here -->
                        </div>

                        <!-- Customer List with Levels -->
                        <div class="glass rounded-xl p-6">
                            <h4 class="text-lg font-semibold text-white mb-4">Klanten Overzicht</h4>
                            <div id="customerLevelsList" class="space-y-4">
                                <div class="empty-state">
                                    <div class="empty-state-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <p class="text-gray-400">Nog geen klanten met levels</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LEADERBOARD TAB -->
                <div id="leaderboard" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">🏆 Leaderboard</h3>
                                <p class="text-gray-400">Bekijk wie de top klanten zijn!</p>
                            </div>
                          <div class="flex gap-3">
    <button onclick="renderLeaderboard()" class="px-4 py-2 rounded-xl bg-indigo-500/20 hover:bg-indigo-500/30 text-indigo-400 text-sm font-medium transition-all">
        <i class="fas fa-sync mr-2"></i>Ververs
    </button>
    <button onclick="resetLeaderboardData()" class="px-4 py-2 rounded-xl bg-red-500/10 hover:bg-red-500/20 text-red-400 text-sm font-medium transition-all">
        <i class="fas fa-undo mr-2"></i>Reset Leaderboard
    </button>
</div>
                        </div>

                        <!-- Tab Switcher -->
                        <div class="flex gap-2 mb-8 p-2 rounded-xl bg-white/5">
                            <button id="leaderboardTabXP" onclick="switchLeaderboardTab('xp')" class="flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all bg-indigo-500 text-white">
                                <i class="fas fa-star mr-2"></i>XP Ranking
                            </button>
                            <button id="leaderboardTabBuyers" onclick="switchLeaderboardTab('buyers')" class="flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all text-gray-400 hover:text-white hover:bg-white/5">
                                <i class="fas fa-shopping-cart mr-2"></i>Top Kopers
                            </button>
                        </div>

                        <!-- XP Ranking Content -->
                        <div id="leaderboardXPContent" class="space-y-6">
                            <!-- Top 3 Podium -->
                            <div id="xpPodium" class="grid grid-cols-3 gap-4 mb-8">
                                <!-- Podium will be rendered here -->
                            </div>
                            
                            <!-- Full XP Ranking List -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-list-ol text-indigo-400"></i>
                                    Volledige XP Ranking
                                </h4>
                                <div id="xpRankingList" class="space-y-3">
                                    <!-- Ranking will be rendered here -->
                                </div>
                            </div>
                        </div>

                        <!-- Top Buyers Content -->
                        <div id="leaderboardBuyersContent" class="space-y-6 hidden">
                            <!-- Top 3 Buyers Podium -->
                            <div id="buyersPodium" class="grid grid-cols-3 gap-4 mb-8">
                                <!-- Podium will be rendered here -->
                            </div>
                            
                            <!-- Full Buyers Ranking List -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-list-ol text-emerald-400"></i>
                                    Top Kopers Ranking
                                </h4>
                                <div id="buyersRankingList" class="space-y-3">
                                    <!-- Ranking will be rendered here -->
                                </div>
                            </div>
                        </div>

                        <!-- Stats Overview -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-8">
                            <div class="glass rounded-xl p-6 text-center">
                                <div class="w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-crown text-amber-400 text-xl"></i>
                                </div>
                                <p class="text-gray-400 text-sm">Top Level</p>
                                <h4 class="text-2xl font-bold text-white" id="leaderboardTopLevel">-</h4>
                            </div>
                            <div class="glass rounded-xl p-6 text-center">
                                <div class="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-users text-indigo-400 text-xl"></i>
                                </div>
                                <p class="text-gray-400 text-sm">Actieve Klanten</p>
                                <h4 class="text-2xl font-bold text-white" id="leaderboardActiveCustomers">0</h4>
                            </div>
                            <div class="glass rounded-xl p-6 text-center">
                                <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-shopping-bag text-emerald-400 text-xl"></i>
                                </div>
                                <p class="text-gray-400 text-sm">Totaal Bestellingen</p>
                                <h4 class="text-2xl font-bold text-white" id="leaderboardTotalOrders">0</h4>
                            </div>
                            <div class="glass rounded-xl p-6 text-center">
                                <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-star text-purple-400 text-xl"></i>
                                </div>
                                <p class="text-gray-400 text-sm">Totaal XP</p>
                                <h4 class="text-2xl font-bold text-white" id="leaderboardTotalXP">0</h4>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LEVEL CONFIGURATIE TAB -->
                <div id="levelConfig" class="tab-content max-w-7xl mx-auto">
                    <div class="glass rounded-2xl p-8 animate-slide-up">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h3 class="text-2xl font-bold text-white font-display mb-2">Level Configuratie</h3>
                                <p class="text-gray-400">Stel XP levels en beloningen in voor je klanten</p>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="resetToDefaultLevels()" class="px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 text-sm font-medium transition-all">
                                    <i class="fas fa-refresh mr-2"></i>Standaard Herstellen
                                </button>
                                <button onclick="openAddLevelModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-medium flex items-center gap-2">
                                    <i class="fas fa-plus"></i>
                                    Level Toevoegen
                                </button>
                            </div>
                        </div>

                        <!-- XP Settings -->
                        <div class="glass rounded-xl p-6 mb-8">
                            <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-cog text-indigo-400"></i>
                                XP Instellingen
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="text-sm text-gray-400 mb-2 block">XP per product</label>
                                    <div class="flex items-center gap-3">
                                        <input type="number" id="xpPerProduct" class="input-glow w-full px-4 py-3 rounded-xl text-white" value="25" min="1" step="5" onchange="updateXPSettings()">
                                        <span class="text-gray-400">XP</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Hoeveel XP krijgt een klant per product?</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-2 block">Bonus XP eerste aankoop</label>
                                    <div class="flex items-center gap-3">
                                        <input type="number" id="xpFirstPurchase" class="input-glow w-full px-4 py-3 rounded-xl text-white" value="50" min="0" step="10" onchange="updateXPSettings()">
                                        <span class="text-gray-400">XP</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Extra XP voor eerste bestelling</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-2 block">Bonus XP terugkerende klant</label>
                                    <div class="flex items-center gap-3">
                                        <input type="number" id="xpReturningBonus" class="input-glow w-full px-4 py-3 rounded-xl text-white" value="10" min="0" step="5" onchange="updateXPSettings()">
                                        <span class="text-gray-400">XP</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Extra XP per terugkerende bestelling</p>
                                </div>
                            </div>
                        </div>

                        <!-- Multi-Product Bonus XP Settings -->
                        <div class="glass rounded-xl p-6 mb-8">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-white flex items-center gap-2">
                                    <i class="fas fa-boxes text-pink-400"></i>
                                    Multi-Product Bonus XP
                                </h4>
                                <button onclick="openAddMultiProductBonusModal()" class="btn-primary px-4 py-2 rounded-lg text-white text-sm flex items-center gap-2">
                                    <i class="fas fa-plus"></i> Bonus Toevoegen
                                </button>
                            </div>
                            <p class="text-sm text-gray-400 mb-4">Beloon klanten extra voor het kopen van meerdere producten in één keer!</p>
                            
                            <div id="multiProductBonusList" class="space-y-3">
                                <!-- Multi-product bonuses will be rendered here -->
                            </div>
                            
                            <div class="mt-4 p-4 rounded-xl bg-white/5 border border-white/10">
                                <h5 class="text-white font-medium mb-2 flex items-center gap-2">
                                    <i class="fas fa-info-circle text-blue-400"></i>
                                    Hoe werkt het?
                                </h5>
                                <p class="text-sm text-gray-400">
                                    Als een klant bijvoorbeeld 2 producten koopt, krijgt ze de bonus voor 2 producten (60 XP). 
                                    Als ze 4 producten koopt, krijgt ze nog steeds de bonus voor 3 producten (90 XP) omdat dat de hoogste match is.
                                    Je kunt zelf kiezen welke bonussen je wilt toevoegen!
                                </p>
                            </div>
                        </div>

                        <!-- Levels List -->
                        <div class="glass rounded-xl p-6">
                            <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-layer-group text-amber-400"></i>
                                Levels & Beloningen
                            </h4>
                            <div id="levelConfigList" class="space-y-4">
                                <!-- Levels will be rendered here -->
                            </div>
                        </div>

                        <!-- Reward Types Info -->
                        <div class="glass rounded-xl p-6 mt-6">
                            <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-info-circle text-blue-400"></i>
                                Beloningstypes
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-4 rounded-xl bg-white/5">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i class="fas fa-euro-sign text-emerald-400"></i>
                                        <span class="text-white font-medium">Korting (€)</span>
                                    </div>
                                    <p class="text-sm text-gray-400">Vast bedrag korting op volgende bestelling</p>
                                    <p class="text-xs text-gray-500 mt-1">Bijv: -5 euro</p>
                                </div>
                                <div class="p-4 rounded-xl bg-white/5">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i class="fas fa-percent text-purple-400"></i>
                                        <span class="text-white font-medium">Korting (%)</span>
                                    </div>
                                    <p class="text-sm text-gray-400">Percentage korting op volgende bestelling</p>
                                    <p class="text-xs text-gray-500 mt-1">Bijv: 10% korting</p>
                                </div>
                                <div class="p-4 rounded-xl bg-white/5">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i class="fas fa-gift text-amber-400"></i>
                                        <span class="text-white font-medium">Gratis Product</span>
                                    </div>
                                    <p class="text-sm text-gray-400">Gratis product bij volgende bestelling</p>
                                    <p class="text-xs text-gray-500 mt-1">Bijv: Gratis verzending</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- MODALS -->

    <div id="customerModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display">Nieuwe Klant</h3>
                <button onclick="closeCustomerModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="saveCustomer(event)" class="space-y-4">
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Naam *</label>
                    <input type="text" id="modalCustomerName" required class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="Volledige naam">
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Email *</label>
                    <input type="email" id="modalCustomerEmail" required class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="email@voorbeeld.be">
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Telefoon</label>
                    <input type="tel" id="modalCustomerPhone" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="+32 ...">
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Adres</label>
                    <input type="text" id="modalCustomerAddress" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="Straat, nummer, stad">
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeCustomerModal()" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-all">
                        Annuleren
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 rounded-xl btn-primary text-white font-medium">
                        Opslaan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display">Nieuw Product</h3>
                <button onclick="closeProductModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="saveProduct(event)" class="space-y-4">
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Product Naam *</label>
                    <input type="text" id="modalProductName" required class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. Laptop Dell XPS">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Verkoop Prijs (€) *</label>
                        <input type="number" id="modalProductPrice" required step="0.01" min="0" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="0.00">
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Aankoop Prijs (€) *</label>
                        <input type="number" id="modalProductPurchasePrice" required step="0.01" min="0" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="0.00">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">SKU *</label>
                        <input type="text" id="modalProductSku" required class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="PRD-001">
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Voorraad *</label>
                        <input type="number" id="modalProductStock" required min="0" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="0">
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Minimum *</label>
                        <input type="number" id="modalProductMinStock" required min="0" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="5">
                    </div>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeProductModal()" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-all">
                        Annuleren
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 rounded-xl btn-primary text-white font-medium">
                        Opslaan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- PROMOCODE MODAL -->
    <div id="promocodeModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display">Nieuwe Promocode</h3>
                <button onclick="closePromocodeModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="savePromocode(event)" class="space-y-4">
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Code *</label>
                    <input type="text" id="modalPromocodeCode" required class="input-glow w-full px-4 py-3 rounded-xl text-white uppercase" placeholder="bijv. WELKOM10">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Type *</label>
                        <select id="modalPromocodeType" required class="input-glow w-full px-4 py-3 rounded-xl text-white">
                            <option value="fixed" class="bg-[#1a1a2e]">Vast bedrag (€)</option>
                            <option value="percentage" class="bg-[#1a1a2e]">Percentage (%)</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Waarde *</label>
                        <input type="number" id="modalPromocodeValue" required step="0.01" min="0" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. 10">
                    </div>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closePromocodeModal()" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-all">
                        Annuleren
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 rounded-xl btn-primary text-white font-medium">
                        Opslaan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="stockModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display">Voorraad Aanpassen</h3>
                <button onclick="closeStockModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="updateStock(event)" class="space-y-4">
                <input type="hidden" id="stockProductId">
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Product</label>
                    <input type="text" id="stockProductName" readonly class="input-glow w-full px-4 py-3 rounded-xl text-gray-400 bg-white/5">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Huidig</label>
                        <input type="number" id="stockCurrent" readonly class="input-glow w-full px-4 py-3 rounded-xl text-gray-400 bg-white/5">
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Nieuw *</label>
                        <input type="number" id="stockNew" required min="0" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="0">
                    </div>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeStockModal()" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-all">
                        Annuleren
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 rounded-xl btn-primary text-white font-medium">
                        Bijwerken
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="invoiceModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display">Nieuwe Factuur</h3>
                <button onclick="closeInvoiceModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="saveInvoice(event)" class="space-y-4">
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Klant *</label>
                    <select id="modalInvoiceCustomer" required class="input-glow w-full px-4 py-3 rounded-xl text-white">
                        <option value="" class="bg-[#1a1a2e]">Selecteer klant...</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Bedrag (€) *</label>
                    <input type="number" id="modalInvoiceAmount" required step="0.01" min="0" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="0.00">
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Beschrijving</label>
                    <input type="text" id="modalInvoiceDesc" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. Diensten februari 2024">
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Status</label>
                    <select id="modalInvoiceStatus" class="input-glow w-full px-4 py-3 rounded-xl text-white">
                        <option value="open" class="bg-[#1a1a2e]">Open</option>
                        <option value="paid" class="bg-[#1a1a2e]">Betaald</option>
                        <option value="late" class="bg-[#1a1a2e]">Te laat</option>
                    </select>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeInvoiceModal()" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-all">
                        Annuleren
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 rounded-xl btn-primary text-white font-medium">
                        Factuur Maken
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="invoicePreviewModal" class="modal">
        <div class="modal-content p-0 max-w-3xl">
            <div class="p-6 border-b border-white/10 flex items-center justify-between bg-white/5">
                <h3 class="text-xl font-bold text-white font-display">Factuur Preview</h3>
                <div class="flex gap-2">
                    <button onclick="downloadInvoice()" class="px-4 py-2 rounded-lg bg-indigo-500 hover:bg-indigo-600 text-white text-sm font-medium transition-colors">
                        <i class="fas fa-download mr-2"></i>Download
                    </button>
                    <button onclick="closeInvoicePreview()" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh] bg-white text-black" id="invoicePreviewContent"></div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content p-6 max-w-lg">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display">Bestelling Details</h3>
                <button onclick="closeOrderDetailsModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="orderDetailsContent" class="space-y-4"></div>
        </div>
    </div>

    <!-- Weekly Report Modal -->
    <div id="reportModal" class="modal">
        <div class="modal-content p-6 max-w-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display">Wekelijks Rapport</h3>
                <button onclick="closeReportModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="reportContent" class="space-y-6"></div>
            <div class="flex gap-3 pt-4 mt-6 border-t border-white/10">
                <button onclick="sendReportViaWhatsApp()" class="flex-1 px-4 py-3 rounded-xl bg-green-500/20 hover:bg-green-500/30 text-green-400 font-medium transition-all">
                    <i class="fab fa-whatsapp mr-2"></i>Verstuur via WhatsApp
                </button>
                <button onclick="closeReportModal()" class="px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-all">
                    Sluiten
                </button>
            </div>
        </div>
    </div>

    <!-- PROFIT SPLIT MODAL -->
    <div id="profitSplitModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display">Nieuwe Winstverdeling Categorie</h3>
                <button onclick="closeProfitSplitModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="saveProfitSplit(event)" class="space-y-4">
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Categorie Naam *</label>
                    <input type="text" id="modalSplitName" required class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. Vakantie">
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Percentage (%) *</label>
                    <input type="number" id="modalSplitPercentage" required step="1" min="1" max="100" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. 20" oninput="validateSplitPercentage(this.value)">
                    <p class="text-xs text-gray-500 mt-1" id="splitPercentageHint">Beschikbaar: 100%</p>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Kleur</label>
                    <div class="flex gap-3 flex-wrap" id="splitColorSelector">
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-emerald-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#10b981"></button>
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-blue-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#3b82f6"></button>
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-purple-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#8b5cf6"></button>
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-pink-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#ec4899"></button>
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-yellow-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#eab308"></button>
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-red-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#ef4444"></button>
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-cyan-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#06b6d4"></button>
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-orange-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#f97316"></button>
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-indigo-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#6366f1"></button>
                        <button type="button" class="split-color-btn w-10 h-10 rounded-full bg-rose-500 ring-2 ring-offset-2 ring-offset-[#1a1a2e] ring-transparent hover:ring-white transition-all" data-color="#f43f5e"></button>
                    </div>
                    <input type="hidden" id="modalSplitColor" value="#10b981">
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeProfitSplitModal()" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-all">
                        Annuleren
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 rounded-xl btn-primary text-white font-medium">
                        Toevoegen
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ADD/EDIT LEVEL MODAL -->
    <div id="levelConfigModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display" id="levelModalTitle">Nieuw Level</h3>
                <button onclick="closeLevelConfigModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="saveLevelConfig(event)" class="space-y-4">
                <input type="hidden" id="editingLevelId" value="">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Level Nummer *</label>
                        <input type="number" id="modalLevelNumber" required min="1" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. 1">
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Level Naam *</label>
                        <input type="text" id="modalLevelName" required class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. Starter">
                    </div>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">XP Vereist *</label>
                    <input type="number" id="modalLevelXP" required min="1" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. 100">
                    <p class="text-xs text-gray-500 mt-1">Hoeveel XP nodig is om dit level te bereiken</p>
                </div>
                <div class="h-px bg-white/10 my-4"></div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Beloning Type</label>
                    <select id="modalRewardType" class="input-glow w-full px-4 py-3 rounded-xl text-white" onchange="updateRewardFields()">
                        <option value="discount_fixed" class="bg-[#1a1a2e]">Korting - Vast bedrag (€)</option>
                        <option value="discount_percentage" class="bg-[#1a1a2e]">Korting - Percentage (%)</option>
                        <option value="free_product" class="bg-[#1a1a2e]">Gratis Product</option>
                        <option value="free_shipping" class="bg-[#1a1a2e]">Gratis Verzending</option>
                        <option value="none" class="bg-[#1a1a2e]">Geen Beloning</option>
                    </select>
                </div>
                <div id="rewardValueField">
                    <label class="text-sm font-medium text-gray-300 block mb-2" id="rewardValueLabel">Korting Bedrag (€)</label>
                    <input type="number" id="modalRewardValue" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. 5">
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Beloning Beschrijving</label>
                    <input type="text" id="modalRewardDesc" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. -€5 op je volgende bestelling!">
                    <p class="text-xs text-gray-500 mt-1">Dit ziet de klant wanneer ze het level bereiken</p>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeLevelConfigModal()" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-all">
                        Annuleren
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 rounded-xl btn-primary text-white font-medium">
                        <i class="fas fa-save mr-2"></i>Opslaan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MULTI-PRODUCT BONUS MODAL -->
    <div id="multiProductBonusModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white font-display" id="multiProductModalTitle">Multi-Product Bonus Toevoegen</h3>
                <button onclick="closeMultiProductBonusModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="saveMultiProductBonus(event)" class="space-y-4">
                <input type="hidden" id="editingMultiProductIndex" value="">
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Aantal Producten *</label>
                    <input type="number" id="modalMultiProductCount" required min="1" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. 2">
                    <p class="text-xs text-gray-500 mt-1">Vanaf hoeveel producten krijgt de klant deze bonus?</p>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Bonus XP *</label>
                    <input type="number" id="modalMultiProductXP" required min="1" class="input-glow w-full px-4 py-3 rounded-xl text-white" placeholder="bijv. 60">
                    <p class="text-xs text-gray-500 mt-1">Hoeveel extra XP krijgt de klant?</p>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeMultiProductBonusModal()" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-all">
                        Annuleren
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 rounded-xl btn-primary text-white font-medium">
                        <i class="fas fa-save mr-2"></i>Opslaan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="social-float-container">
        <a href="https://web.snapchat.com" target="_blank" class="social-float snapchat-float" title="Snapchat Web">
            <i class="fab fa-snapchat-ghost text-black text-2xl"></i>
        </a>
        <a href="https://wa.me/320470281020" target="_blank" class="social-float whatsapp-float" title="WhatsApp">
            <i class="fab fa-whatsapp text-white text-2xl"></i>
        </a>
    </div>

    <div id="toast" class="toast glass-strong rounded-xl p-4 flex items-center gap-3 border border-white/10 shadow-2xl max-w-sm">
        <div id="toastIcon" class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
            <i class="fas fa-check text-emerald-400"></i>
        </div>
        <div class="flex-1">
            <h4 id="toastTitle" class="text-sm font-semibold text-white mb-0.5">Succes!</h4>
            <p id="toastMessage" class="text-xs text-gray-400">Actie voltooid.</p>
        </div>
        <button onclick="hideToast()" class="text-gray-400 hover:text-white transition-colors">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <script>
        // DATA STORAGE - Using localStorage for persistence
        let products = JSON.parse(localStorage.getItem('kenzie_products')) || [];
        let customers = JSON.parse(localStorage.getItem('kenzie_customers')) || [];
        let invoices = JSON.parse(localStorage.getItem('kenzie_invoices')) || [];
        let orders = JSON.parse(localStorage.getItem('kenzie_orders')) || [];
        let promocodes = JSON.parse(localStorage.getItem('kenzie_promocodes')) || [];
        let profitSplit = JSON.parse(localStorage.getItem('kenzie_profitSplit')) || [];
        let orderProducts = [];
        let currentInvoiceId = null;
        let nextId = JSON.parse(localStorage.getItem('kenzie_nextId')) || { product: 1, customer: 1, invoice: 1, order: 1, promocode: 1, profitSplit: 1 };
        let settings = JSON.parse(localStorage.getItem('kenzie_settings')) || { 
            whatsapp: true, 
            email: true, 
            weeklyReport: true,
            whatsappNumber: '+32 0470281020'
        };
        let lastReportDate = localStorage.getItem('kenzie_lastReportDate') || null;
        let currentPromocode = null;
        let editingSplitId = null;

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('kenzie_products', JSON.stringify(products));
            localStorage.setItem('kenzie_customers', JSON.stringify(customers));
            localStorage.setItem('kenzie_invoices', JSON.stringify(invoices));
            localStorage.setItem('kenzie_orders', JSON.stringify(orders));
            localStorage.setItem('kenzie_promocodes', JSON.stringify(promocodes));
            localStorage.setItem('kenzie_profitSplit', JSON.stringify(profitSplit));
            localStorage.setItem('kenzie_nextId', JSON.stringify(nextId));
            localStorage.setItem('kenzie_settings', JSON.stringify(settings));
            localStorage.setItem('kenzie_xpSettings', JSON.stringify(xpSettings));
            localStorage.setItem('kenzie_customerLevels', JSON.stringify(customerLevels));
            localStorage.setItem('kenzie_customerXP', JSON.stringify(customerXPData));
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderAll();
            setupSearch();
            checkWeeklyReport();
            loadSettings();
            setupSplitColorSelector();
            
            // Check for weekly report every minute
            setInterval(checkWeeklyReport, 60000);
        });

        function loadSettings() {
            document.getElementById('whatsappNumber').value = settings.whatsappNumber || '+32 0470281020';
        }

        function renderAll() {
            renderCustomers();
            renderProducts();
            renderInventory();
            renderInvoices();
            renderOrders();
            renderPromocodes();
            renderGoals();
            renderProfitSplit();
            renderLevelConfig();
            renderCustomerLevels();
            updateStats();
            updateSelects();
            updateAnalytics();
        }

        function updateStats() {
            document.getElementById('customerCount').textContent = customers.length;
            document.getElementById('productCount').textContent = products.length;
            document.getElementById('invoiceCount').textContent = invoices.length;
            document.getElementById('promocodeCount').textContent = promocodes.length;
            document.getElementById('totalCustomers').textContent = customers.length;
            document.getElementById('totalOrders').textContent = orders.length;
            
            // Calculate today's revenue
            const today = new Date().toDateString();
            const todayOrders = orders.filter(o => new Date(o.timestamp).toDateString() === today);
            const todayRevenue = todayOrders.reduce((sum, o) => sum + o.total, 0);
            document.getElementById('todayRevenue').textContent = '€' + todayRevenue.toFixed(2).replace('.', ',');
            
            // Calculate order change
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayOrders = orders.filter(o => new Date(o.timestamp).toDateString() === yesterday.toDateString());
            const orderChange = yesterdayOrders.length > 0 ? ((todayOrders.length - yesterdayOrders.length) / yesterdayOrders.length * 100).toFixed(0) : 0;
            document.getElementById('orderChange').textContent = (orderChange >= 0 ? '+' : '') + orderChange + '%';
            document.getElementById('orderChange').className = 'text-xs ' + (orderChange >= 0 ? 'text-emerald-400 bg-emerald-500/10' : 'text-red-400 bg-red-500/10') + ' px-2 py-1 rounded-full';
            
            // Calculate revenue change
            const yesterdayRevenue = yesterdayOrders.reduce((sum, o) => sum + o.total, 0);
            const revenueChange = yesterdayRevenue > 0 ? ((todayRevenue - yesterdayRevenue) / yesterdayRevenue * 100).toFixed(0) : 0;
            document.getElementById('revenueChange').textContent = (revenueChange >= 0 ? '+' : '') + revenueChange + '%';
            document.getElementById('revenueChange').className = 'text-xs ' + (revenueChange >= 0 ? 'text-emerald-400 bg-emerald-500/10' : 'text-red-400 bg-red-500/10') + ' px-2 py-1 rounded-full';
            
            const lowStock = products.filter(p => p.stock <= p.minStock).length;
            document.getElementById('lowStockCount').textContent = lowStock + ' items';
            document.getElementById('inventoryBadge').textContent = lowStock;
            
            const banner = document.getElementById('lowStockBanner');
            if (banner) {
                banner.style.display = lowStock > 0 ? 'flex' : 'none';
            }

            // Update notification badge
            const notificationBadge = document.getElementById('notificationBadge');
            if (orders.length > 0) {
                notificationBadge.textContent = orders.filter(o => o.status === 'new').length || orders.length;
                notificationBadge.classList.remove('hidden');
            } else {
                notificationBadge.classList.add('hidden');
            }
        }

        function updateSelects() {
            const customerSelect = document.getElementById('customerSelect');
            const currentCustomer = customerSelect.value;
            customerSelect.innerHTML = '<option value="" class="bg-[#1a1a2e]">Selecteer klant...</option>' +
                customers.map(c => `<option value="${c.id}" class="bg-[#1a1a2e]">${c.name} - ${c.email}</option>`).join('') +
                '<option value="new" class="bg-[#1a1a2e] text-indigo-400">+ Nieuwe klant toevoegen</option>';
            customerSelect.value = currentCustomer;

            const invoiceSelect = document.getElementById('modalInvoiceCustomer');
            if (invoiceSelect) {
                invoiceSelect.innerHTML = '<option value="" class="bg-[#1a1a2e]">Selecteer klant...</option>' +
                    customers.map(c => `<option value="${c.id}" class="bg-[#1a1a2e]">${c.name}</option>`).join('');
            }
        }

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.tab === tabName) {
                    item.classList.add('active');
                }
            });

            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
                
                const titles = {
                    'orders': 'Nieuwe Bestelling',
                    'customers': 'Klantenbeheer',
                    'products': 'Productcatalogus',
                    'inventory': 'Voorraadbeheer',
                    'promocodes': 'Promocodes',
                    'analytics': 'Analytics Dashboard',
                    'invoices': 'Facturen',
                    'goals': 'Doelstellingen',
                    'profitSplit': 'Winstverdeling',
                    'settings': 'Instellingen',
                    'levelConfig': 'Level Configuratie',
                    'customerLevels': 'Klanten Levels',
                    'leaderboard': '🏆 Leaderboard'
                };
                document.getElementById('pageTitle').textContent = titles[tabName] || 'Kenzie';
                
                // Render specifieke content voor bepaalde tabs
                if (tabName === 'levelConfig') {
                    renderLevelConfig();
                } else if (tabName === 'customerLevels') {
                    renderCustomerLevels();
                } else if (tabName === 'leaderboard') {
                    renderLeaderboard();
                }
            }
        }

        // Customer Functions
        function renderCustomers() {
            const grid = document.getElementById('customersGrid');
            if (customers.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state col-span-full">
                        <div class="empty-state-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h4 class="text-lg font-medium text-white mb-2">Geen klanten</h4>
                        <p class="text-sm text-gray-400 mb-4">Voeg je eerste klant toe</p>
                        <button onclick="openCustomerModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-medium">
                            <i class="fas fa-plus mr-2"></i>Klant Toevoegen
                        </button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = customers.map(c => `
                <div class="glass rounded-xl p-6 hover-card cursor-pointer" onclick="editCustomer(${c.id})">
                    <div class="flex items-start justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 font-bold text-lg">${c.name.charAt(0)}</div>
                        <button onclick="event.stopPropagation(); deleteCustomer(${c.id})" class="text-gray-400 hover:text-red-400 transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <h4 class="text-lg font-semibold text-white mb-1">${c.name}</h4>
                    <p class="text-sm text-gray-400 mb-3">${c.email}</p>
                    ${c.phone ? `<p class="text-xs text-gray-500 mb-1"><i class="fas fa-phone mr-1"></i> ${c.phone}</p>` : ''}
                    ${c.address ? `<p class="text-xs text-gray-500"><i class="fas fa-map-marker-alt mr-1"></i> ${c.address}</p>` : ''}
                </div>
            `).join('');
        }

        function openCustomerModal() {
            document.getElementById('customerModal').classList.add('active');
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').classList.remove('active');
            document.getElementById('modalCustomerName').value = '';
            document.getElementById('modalCustomerEmail').value = '';
            document.getElementById('modalCustomerPhone').value = '';
            document.getElementById('modalCustomerAddress').value = '';
        }

        function saveCustomer(e) {
            e.preventDefault();
            const newCustomer = {
                id: nextId.customer++,
                name: document.getElementById('modalCustomerName').value,
                email: document.getElementById('modalCustomerEmail').value,
                phone: document.getElementById('modalCustomerPhone').value,
                address: document.getElementById('modalCustomerAddress').value,
                number: 'CUST-' + String(nextId.customer).padStart(3, '0'),
                createdAt: new Date().toISOString()
            };
            customers.push(newCustomer);
            saveData();
            renderCustomers();
            updateSelects();
            updateStats();
            closeCustomerModal();
            showToast('Succes', 'Klant toegevoegd', 'success');
        }

        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) return;
            
            document.getElementById('modalCustomerName').value = customer.name;
            document.getElementById('modalCustomerEmail').value = customer.email;
            document.getElementById('modalCustomerPhone').value = customer.phone || '';
            document.getElementById('modalCustomerAddress').value = customer.address || '';
            
            const form = document.querySelector('#customerModal form');
            form.onsubmit = function(e) {
                e.preventDefault();
                customer.name = document.getElementById('modalCustomerName').value;
                customer.email = document.getElementById('modalCustomerEmail').value;
                customer.phone = document.getElementById('modalCustomerPhone').value;
                customer.address = document.getElementById('modalCustomerAddress').value;
                saveData();
                renderCustomers();
                updateSelects();
                closeCustomerModal();
                showToast('Succes', 'Klant bijgewerkt', 'success');
                form.onsubmit = saveCustomer;
            };
            
            document.getElementById('customerModal').classList.add('active');
        }

        function deleteCustomer(id) {
            if (!confirm('Klant verwijderen?')) return;
            customers = customers.filter(c => c.id !== id);
            saveData();
            renderCustomers();
            updateSelects();
            updateStats();
            showToast('Verwijderd', 'Klant verwijderd', 'info');
        }

        // Product Functions
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            if (products.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state col-span-full">
                        <div class="empty-state-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <h4 class="text-lg font-medium text-white mb-2">Geen producten</h4>
                        <p class="text-sm text-gray-400 mb-4">Voeg je eerste product toe</p>
                        <button onclick="openProductModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-medium">
                            <i class="fas fa-plus mr-2"></i>Product Toevoegen
                        </button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = products.map(p => {
                const isLowStock = p.stock <= p.minStock;
                return `
                    <div class="glass rounded-xl overflow-hidden hover-card cursor-pointer" onclick="editProduct(${p.id})">
                        <div class="h-32 bg-gradient-to-br ${isLowStock ? 'from-red-500/20 to-orange-500/20' : 'from-blue-500/20 to-purple-500/20'} flex items-center justify-center relative">
                            <i class="fas fa-box text-4xl ${isLowStock ? 'text-red-400' : 'text-gray-400'}"></i>
                            ${isLowStock ? '<span class="absolute top-2 right-2 px-2 py-1 rounded-full bg-red-500 text-white text-xs">LAAG</span>' : ''}
                            <button onclick="event.stopPropagation(); deleteProduct(${p.id})" class="absolute top-2 left-2 w-8 h-8 rounded-full bg-black/50 text-white hover:bg-red-500 flex items-center justify-center transition-colors">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-lg font-semibold text-white">${p.name}</h4>
                                <span class="text-lg font-bold text-gradient">€${p.price.toFixed(2)}</span>
                            </div>
                            <p class="text-sm text-gray-400 mb-2">SKU: ${p.sku}</p>
                            <p class="text-xs text-gray-500 mb-4">Inkoop: €${(p.purchasePrice || 0).toFixed(2)}</p>
                            <div class="flex items-center justify-between">
                                <span class="text-xs text-gray-500">Voorraad: ${p.stock}</span>
                                <span class="px-2 py-1 rounded-full ${isLowStock ? 'bg-red-500/10 text-red-400 border border-red-500/20' : 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20'} text-xs">
                                    ${isLowStock ? 'Laag' : 'OK'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openProductModal() {
            document.getElementById('productModal').classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
            document.getElementById('modalProductName').value = '';
            document.getElementById('modalProductPrice').value = '';
            document.getElementById('modalProductPurchasePrice').value = '';
            document.getElementById('modalProductSku').value = '';
            document.getElementById('modalProductStock').value = '';
            document.getElementById('modalProductMinStock').value = '';
        }

        function saveProduct(e) {
            e.preventDefault();
            const newProduct = {
                id: nextId.product++,
                name: document.getElementById('modalProductName').value,
                price: parseFloat(document.getElementById('modalProductPrice').value),
                purchasePrice: parseFloat(document.getElementById('modalProductPurchasePrice').value),
                sku: document.getElementById('modalProductSku').value,
                stock: parseInt(document.getElementById('modalProductStock').value),
                minStock: parseInt(document.getElementById('modalProductMinStock').value)
            };
            products.push(newProduct);
            saveData();
            renderProducts();
            renderInventory();
            updateStats();
            closeProductModal();
            showToast('Succes', 'Product toegevoegd', 'success');
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            document.getElementById('modalProductName').value = product.name;
            document.getElementById('modalProductPrice').value = product.price;
            document.getElementById('modalProductPurchasePrice').value = product.purchasePrice || 0;
            document.getElementById('modalProductSku').value = product.sku;
            document.getElementById('modalProductStock').value = product.stock;
            document.getElementById('modalProductMinStock').value = product.minStock;
            
            const form = document.querySelector('#productModal form');
            form.onsubmit = function(e) {
                e.preventDefault();
                product.name = document.getElementById('modalProductName').value;
                product.price = parseFloat(document.getElementById('modalProductPrice').value);
                product.purchasePrice = parseFloat(document.getElementById('modalProductPurchasePrice').value);
                product.sku = document.getElementById('modalProductSku').value;
                product.stock = parseInt(document.getElementById('modalProductStock').value);
                product.minStock = parseInt(document.getElementById('modalProductMinStock').value);
                saveData();
                renderProducts();
                renderInventory();
                updateStats();
                closeProductModal();
                showToast('Succes', 'Product bijgewerkt', 'success');
                form.onsubmit = saveProduct;
            };
            
            document.getElementById('productModal').classList.add('active');
        }

        function deleteProduct(id) {
            if (!confirm('Product verwijderen?')) return;
            products = products.filter(p => p.id !== id);
            saveData();
            renderProducts();
            renderInventory();
            updateStats();
            showToast('Verwijderd', 'Product verwijderd', 'info');
        }

        // PROMOCODE FUNCTIONS
        function renderPromocodes() {
            const grid = document.getElementById('promocodesGrid');
            if (promocodes.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state col-span-full">
                        <div class="empty-state-icon">
                            <i class="fas fa-tag"></i>
                        </div>
                        <h4 class="text-lg font-medium text-white mb-2">Geen promocodes</h4>
                        <p class="text-sm text-gray-400 mb-4">Maak je eerste kortingscode aan</p>
                        <button onclick="openPromocodeModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-medium">
                            <i class="fas fa-plus mr-2"></i>Code Aanmaken
                        </button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = promocodes.map(pc => `
                <div class="glass rounded-xl p-6 hover-card cursor-pointer" onclick="editPromocode(${pc.id})">
                    <div class="flex items-start justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                            <i class="fas fa-tag text-emerald-400 text-lg"></i>
                        </div>
                        <button onclick="event.stopPropagation(); deletePromocode(${pc.id})" class="text-gray-400 hover:text-red-400 transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <h4 class="text-lg font-semibold text-white mb-1 font-mono">${pc.code}</h4>
                    <p class="text-sm text-gray-400 mb-3">
                        ${pc.type === 'fixed' ? '€' + pc.value.toFixed(2) + ' korting' : pc.value + '% korting'}
                    </p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">Gebruikt: ${pc.usageCount || 0}x</span>
                        <span class="px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-xs">
                            Actief
                        </span>
                    </div>
                </div>
            `).join('');
        }

        function openPromocodeModal() {
            document.getElementById('promocodeModal').classList.add('active');
        }

        function closePromocodeModal() {
            document.getElementById('promocodeModal').classList.remove('active');
            document.getElementById('modalPromocodeCode').value = '';
            document.getElementById('modalPromocodeType').value = 'fixed';
            document.getElementById('modalPromocodeValue').value = '';
        }

        function savePromocode(e) {
            e.preventDefault();
            const newPromocode = {
                id: nextId.promocode++,
                code: document.getElementById('modalPromocodeCode').value.toUpperCase(),
                type: document.getElementById('modalPromocodeType').value,
                value: parseFloat(document.getElementById('modalPromocodeValue').value),
                usageCount: 0,
                createdAt: new Date().toISOString()
            };
            promocodes.push(newPromocode);
            saveData();
            renderPromocodes();
            updateStats();
            closePromocodeModal();
            showToast('Succes', 'Promocode aangemaakt', 'success');
        }

        function editPromocode(id) {
            const promocode = promocodes.find(pc => pc.id === id);
            if (!promocode) return;
            
            document.getElementById('modalPromocodeCode').value = promocode.code;
            document.getElementById('modalPromocodeType').value = promocode.type;
            document.getElementById('modalPromocodeValue').value = promocode.value;
            
            const form = document.querySelector('#promocodeModal form');
            form.onsubmit = function(e) {
                e.preventDefault();
                promocode.code = document.getElementById('modalPromocodeCode').value.toUpperCase();
                promocode.type = document.getElementById('modalPromocodeType').value;
                promocode.value = parseFloat(document.getElementById('modalPromocodeValue').value);
                saveData();
                renderPromocodes();
                closePromocodeModal();
                showToast('Succes', 'Promocode bijgewerkt', 'success');
                form.onsubmit = savePromocode;
            };
            
            document.getElementById('promocodeModal').classList.add('active');
        }

        function deletePromocode(id) {
            if (!confirm('Promocode verwijderen?')) return;
            promocodes = promocodes.filter(pc => pc.id !== id);
            saveData();
            renderPromocodes();
            updateStats();
            showToast('Verwijderd', 'Promocode verwijderd', 'info');
        }

        function validatePromocode(code) {
            const input = document.getElementById('promocodeInput');
            const status = document.getElementById('promocodeStatus');
            
            if (!code) {
                input.classList.remove('promo-valid', 'promo-invalid');
                status.innerHTML = '';
                currentPromocode = null;
                calculateTotal();
                return;
            }
            
            const upperCode = code.toUpperCase();
            
            // Special "kenzie" code - always valid for personal use (100% discount)
            if (upperCode === 'KENZIE') {
                input.classList.remove('promo-invalid');
                input.classList.add('promo-valid');
                status.innerHTML = `<i class="fas fa-check-circle text-purple-400 mr-1"></i><span class="text-purple-400">Persoonlijk gebruik (geen winst)</span>`;
                currentPromocode = {
                    code: 'KENZIE',
                    type: 'percentage',
                    value: 100
                };
                calculateTotal();
                return;
            }
            
            const promocode = promocodes.find(pc => pc.code === upperCode);
            
            if (promocode) {
                input.classList.remove('promo-invalid');
                input.classList.add('promo-valid');
                status.innerHTML = `<i class="fas fa-check-circle text-emerald-400 mr-1"></i><span class="text-emerald-400">Geldig: ${promocode.type === 'fixed' ? '€' + promocode.value.toFixed(2) : promocode.value + '%'} korting</span>`;
                currentPromocode = promocode;
            } else {
                input.classList.remove('promo-valid');
                input.classList.add('promo-invalid');
                status.innerHTML = `<i class="fas fa-times-circle text-red-400 mr-1"></i><span class="text-red-400">Ongeldige code</span>`;
                currentPromocode = null;
            }
            
            calculateTotal();
        }

        // Inventory Functions
        function renderInventory() {
            const tbody = document.getElementById('inventoryTable');
            if (products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="py-12 text-center text-gray-400">
                            <div class="empty-state-icon mx-auto mb-4" style="width: 60px; height: 60px; font-size: 24px;">
                                <i class="fas fa-warehouse"></i>
                            </div>
                            <p>Geen producten in voorraad</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = products.map(p => {
                const isLowStock = p.stock <= p.minStock;
                return `
                    <tr class="border-b border-white/5 hover:bg-white/5 transition-colors">
                        <td class="py-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg ${isLowStock ? 'bg-red-500/20' : 'bg-blue-500/20'} flex items-center justify-center">
                                    <i class="fas fa-box ${isLowStock ? 'text-red-400' : 'text-blue-400'}"></i>
                                </div>
                                <span class="text-white font-medium">${p.name}</span>
                            </div>
                        </td>
                        <td class="py-4 text-gray-400">${p.sku}</td>
                        <td class="py-4 text-center ${isLowStock ? 'text-red-400 font-bold' : 'text-emerald-400'}">${p.stock}</td>
                        <td class="py-4 text-center text-gray-400">${p.minStock}</td>
                        <td class="py-4 text-center">
                            <span class="px-2 py-1 rounded-full ${isLowStock ? 'bg-red-500/10 text-red-400 border border-red-500/20' : 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20'} text-xs">
                                ${isLowStock ? 'Kritiek' : 'OK'}
                            </span>
                        </td>
                        <td class="py-4 text-right">
                            <button class="text-indigo-400 hover:text-indigo-300 mr-3" onclick="openStockModal(${p.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openStockModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('stockProductId').value = productId;
            document.getElementById('stockProductName').value = product.name;
            document.getElementById('stockCurrent').value = product.stock;
            document.getElementById('stockNew').value = product.stock;
            
            document.getElementById('stockModal').classList.add('active');
        }

        function closeStockModal() {
            document.getElementById('stockModal').classList.remove('active');
        }

        function updateStock(e) {
            e.preventDefault();
            const productId = parseInt(document.getElementById('stockProductId').value);
            const newStock = parseInt(document.getElementById('stockNew').value);
            const product = products.find(p => p.id === productId);
            
            if (product) {
                product.stock = newStock;
                saveData();
                renderInventory();
                renderProducts();
                updateStats();
                closeStockModal();
                showToast('Succes', `Voorraad bijgewerkt naar ${newStock}`, 'success');
            }
        }

        // Invoice Functions
        function renderInvoices() {
            const container = document.getElementById('invoicesList');
            if (invoices.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <h4 class="text-lg font-medium text-white mb-2">Geen facturen</h4>
                        <p class="text-sm text-gray-400 mb-4">Maak je eerste factuur</p>
                        <button onclick="openInvoiceModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-medium">
                            <i class="fas fa-plus mr-2"></i>Factuur Maken
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = invoices.map(inv => {
                const customer = customers.find(c => c.id === inv.customerId);
                const statusColors = {
                    'paid': 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
                    'open': 'bg-amber-500/10 text-amber-400 border-amber-500/20',
                    'late': 'bg-red-500/10 text-red-400 border-red-500/20'
                };
                const statusLabels = {
                    'paid': 'Betaald',
                    'open': 'Open',
                    'late': 'Te laat'
                };
                
                return `
                    <div class="glass rounded-xl p-6 flex items-center justify-between hover-card cursor-pointer" onclick="previewInvoice(${inv.id})">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl ${inv.status === 'paid' ? 'bg-emerald-500/20' : inv.status === 'late' ? 'bg-red-500/20' : 'bg-amber-500/20'} flex items-center justify-center">
                                <i class="fas fa-file-invoice ${inv.status === 'paid' ? 'text-emerald-400' : inv.status === 'late' ? 'text-red-400' : 'text-amber-400'} text-xl"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-medium">#${inv.number}</h4>
                                <p class="text-sm text-gray-400">${customer ? customer.name : 'Onbekend'} • ${inv.date}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-6">
                            <span class="text-lg font-bold text-white">€${inv.amount.toFixed(2)}</span>
                            <span class="px-3 py-1 rounded-full ${statusColors[inv.status]} text-sm border">${statusLabels[inv.status]}</span>
                            <div class="flex gap-2">
                                <button onclick="event.stopPropagation(); downloadInvoice(${inv.id})" class="p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button onclick="event.stopPropagation(); deleteInvoice(${inv.id})" class="p-2 rounded-lg hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-colors">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openInvoiceModal() {
            if (customers.length === 0) {
                showToast('Fout', 'Voeg eerst een klant toe', 'error');
                return;
            }
            document.getElementById('invoiceModal').classList.add('active');
        }

        function closeInvoiceModal() {
            document.getElementById('invoiceModal').classList.remove('active');
            document.getElementById('modalInvoiceCustomer').value = '';
            document.getElementById('modalInvoiceAmount').value = '';
            document.getElementById('modalInvoiceDesc').value = '';
            document.getElementById('modalInvoiceStatus').value = 'open';
        }

        function saveInvoice(e) {
            e.preventDefault();
            const newInvoice = {
                id: nextId.invoice++,
                number: 'FACT-2024-' + String(nextId.invoice).padStart(3, '0'),
                customerId: parseInt(document.getElementById('modalInvoiceCustomer').value),
                amount: parseFloat(document.getElementById('modalInvoiceAmount').value),
                description: document.getElementById('modalInvoiceDesc').value,
                status: document.getElementById('modalInvoiceStatus').value,
                date: new Date().toLocaleDateString('nl-NL', { day: 'numeric', month: 'short', year: 'numeric' })
            };
            invoices.push(newInvoice);
            saveData();
            renderInvoices();
            updateStats();
            closeInvoiceModal();
            showToast('Succes', 'Factuur aangemaakt', 'success');
        }

        function deleteInvoice(id) {
            if (!confirm('Factuur verwijderen?')) return;
            invoices = invoices.filter(i => i.id !== id);
            saveData();
            renderInvoices();
            updateStats();
            showToast('Verwijderd', 'Factuur verwijderd', 'info');
        }

        function previewInvoice(id) {
            const invoice = invoices.find(i => i.id === id);
            const customer = customers.find(c => c.id === invoice.customerId);
            currentInvoiceId = id;
            
            const content = document.getElementById('invoicePreviewContent');
            content.innerHTML = `
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 40px;">
                        <div>
                            <h1 style="font-size: 32px; margin: 0; color: #6366f1;">FACTUUR</h1>
                            <p style="margin: 5px 0; color: #666;">#${invoice.number}</p>
                            <p style="margin: 5px 0; color: #666;">${invoice.date}</p>
                        </div>
                        <div style="text-align: right;">
                            <h2 style="margin: 0; color: #333;">Kenzie</h2>
                            <p style="margin: 5px 0; color: #666;">Jouw Bedrijf</p>
                            <p style="margin: 5px 0; color: #666;">+32 0470281020</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <p style="color: #999; margin: 0 0 5px 0; font-size: 12px; text-transform: uppercase;">Factuur aan:</p>
                        <p style="margin: 0; font-size: 18px; font-weight: bold; color: #333;">${customer ? customer.name : 'Onbekend'}</p>
                        ${customer && customer.address ? `<p style="margin: 5px 0; color: #666;">${customer.address}</p>` : ''}
                        ${customer ? `<p style="margin: 5px 0; color: #666;">${customer.email}</p>` : ''}
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #e5e7eb;">
                                <th style="text-align: left; padding: 10px 0; color: #666;">Omschrijving</th>
                                <th style="text-align: right; padding: 10px 0; color: #666;">Bedrag</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #f3f4f6;">
                                <td style="padding: 15px 0; color: #333;">${invoice.description || 'Diensten'}</td>
                                <td style="padding: 15px 0; text-align: right; color: #333;">€${invoice.amount.toFixed(2)}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="display: flex; justify-content: flex-end; margin-bottom: 30px;">
                        <div style="width: 250px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #666;">Subtotaal:</span>
                                <span style="color: #333;">€${invoice.amount.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #666;">BTW (21%):</span>
                                <span style="color: #333;">€${(invoice.amount * 0.21).toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; border-top: 2px solid #e5e7eb; padding-top: 10px; font-size: 18px; font-weight: bold;">
                                <span style="color: #333;">Totaal:</span>
                                <span style="color: #6366f1;">€${(invoice.amount * 1.21).toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin-top: 40px;">
                        <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">Betaling binnen 30 dagen:</p>
                        <p style="margin: 0; font-family: monospace; font-size: 16px; color: #333;">BE68 5390 0754 7034</p>
                    </div>
                </div>
            `;
            
            document.getElementById('invoicePreviewModal').classList.add('active');
        }

        function closeInvoicePreview() {
            document.getElementById('invoicePreviewModal').classList.remove('active');
            currentInvoiceId = null;
        }

        function downloadInvoice(id) {
            const invoice = invoices.find(i => i.id === id) || invoices.find(i => i.id === currentInvoiceId);
            if (!invoice) return;
            
            const customer = customers.find(c => c.id === invoice.customerId);
            const content = `
FACTUUR ${invoice.number}
Datum: ${invoice.date}

VAN:
Kenzie
+32 0470281020

AAN:
${customer ? customer.name : 'Onbekend'}
${customer ? customer.address || '' : ''}
${customer ? customer.email || '' : ''}

Omschrijving: ${invoice.description || 'Diensten'}
Bedrag: €${invoice.amount.toFixed(2)}
BTW (21%): €${(invoice.amount * 0.21).toFixed(2)}
Totaal: €${(invoice.amount * 1.21).toFixed(2)}

Status: ${invoice.status === 'paid' ? 'Betaald' : invoice.status === 'late' ? 'Te laat' : 'Open'}
            `;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${invoice.number}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Download', 'Factuur gedownload', 'success');
        }

        // ORDER FUNCTIONS - FIXED
        function handleCustomerChange(value) {
            const newCustomerFields = document.getElementById('newCustomerFields');
            const customerNumber = document.getElementById('customerNumber');
            
            if (value === 'new') {
                newCustomerFields.classList.remove('hidden');
                customerNumber.value = 'NEW-' + Math.floor(Math.random() * 1000);
                renderCustomerLevelInfo('new');
            } else if (value) {
                newCustomerFields.classList.add('hidden');
                const customer = customers.find(c => c.id === parseInt(value));
                if (customer) {
                    customerNumber.value = customer.number;
                    renderCustomerLevelInfo(customer.id);
                }
            } else {
                newCustomerFields.classList.add('hidden');
                customerNumber.value = '';
                renderCustomerLevelInfo(null);
            }
        }

        function addProductRow() {
            if (products.length === 0) {
                showToast('Fout', 'Voeg eerst producten toe', 'error');
                return;
            }

            const emptyState = document.getElementById('emptyState');
            const productList = document.getElementById('productList');
            
            emptyState.classList.add('hidden');
            
            const rowId = Date.now();
            const product = products[0];
            
            const row = document.createElement('div');
            row.className = 'product-row glass rounded-xl p-4 flex flex-col md:flex-row gap-4 items-start md:items-center animate-slide-up';
            row.id = `product-row-${rowId}`;
            
            const isLowStock = product.stock <= product.minStock;
            
            row.innerHTML = `
                <div class="flex-1 grid grid-cols-1 md:grid-cols-12 gap-4 w-full">
                    <div class="md:col-span-5">
                        <label class="text-xs text-gray-400 mb-1 block">Product</label>
                        <select class="input-glow w-full px-3 py-2 rounded-lg text-sm text-white" onchange="updateProduct(${rowId}, this.value)">
                            ${products.map(p => `
                                <option value="${p.id}" ${p.id === product.id ? 'selected' : ''}>
                                    ${p.name} ${p.stock <= p.minStock ? '(LAAG: ' + p.stock + ')' : ''} - €${p.price.toFixed(2)}
                                </option>
                            `).join('')}
                        </select>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="text-xs text-gray-400 mb-1 block">Prijs</label>
                        <div class="input-glow px-3 py-2 rounded-lg text-sm text-white flex items-center">
                            <span class="text-gray-500 mr-1">€</span>
                            <span id="price-${rowId}">${product.price.toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="text-xs text-gray-400 mb-1 block">Aantal</label>
                        <div class="number-control">
                            <button type="button" class="number-btn rounded-l-lg" onclick="updateQuantity(${rowId}, -1)">
                                <i class="fas fa-minus text-xs"></i>
                            </button>
                            <input type="number" id="qty-${rowId}" value="1" min="1" max="${product.stock}" 
                                   class="w-12 text-center bg-transparent text-white text-sm" 
                                   onchange="calculateTotal()">
                            <button type="button" class="number-btn rounded-r-lg" onclick="updateQuantity(${rowId}, 1)">
                                <i class="fas fa-plus text-xs"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="text-xs text-gray-400 mb-1 block">Totaal</label>
                        <div class="text-sm font-semibold text-white" id="total-${rowId}">
                            €${product.price.toFixed(2)}
                        </div>
                    </div>
                    
                    <div class="md:col-span-1 flex items-end justify-end">
                        <button type="button" onclick="removeProductRow(${rowId})" 
                                class="p-2 rounded-lg hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-all">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                
                ${isLowStock ? `
                    <div class="w-full mt-2 p-2 rounded-lg bg-red-500/10 border border-red-500/20 text-xs text-red-400 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>Let op: slechts ${product.stock} op voorraad!</span>
                    </div>
                ` : ''}
            `;
            
            productList.appendChild(row);
            orderProducts.push({ rowId, productId: product.id, quantity: 1 });
            
            if (isLowStock) {
                row.classList.add('stock-alert');
            }
            
            calculateTotal();
        }

        function updateProduct(rowId, productId) {
            const product = products.find(p => p.id === parseInt(productId));
            const row = document.getElementById(`product-row-${rowId}`);
            
            document.getElementById(`price-${rowId}`).textContent = product.price.toFixed(2);
            document.getElementById(`qty-${rowId}`).max = product.stock;
            
            const existingWarning = row.querySelector('.bg-red-500\\/10');
            if (existingWarning) existingWarning.remove();
            
            if (product.stock <= product.minStock) {
                row.classList.add('stock-alert');
                const warning = document.createElement('div');
                warning.className = 'w-full mt-2 p-2 rounded-lg bg-red-500/10 border border-red-500/20 text-xs text-red-400 flex items-center gap-2 animate-slide-up';
                warning.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Let op: slechts ${product.stock} op voorraad!</span>
                `;
                row.appendChild(warning);
            } else {
                row.classList.remove('stock-alert');
            }
            
            const orderItem = orderProducts.find(p => p.rowId === rowId);
            if (orderItem) {
                orderItem.productId = product.id;
            }
            
            calculateTotal();
        }

        function updateQuantity(rowId, change) {
            const input = document.getElementById(`qty-${rowId}`);
            const newValue = parseInt(input.value) + change;
            const max = parseInt(input.max);
            
            if (newValue >= 1 && newValue <= max) {
                input.value = newValue;
                calculateTotal();
            } else if (newValue > max) {
                showToast('Voorraad limiet', `Maximaal ${max} items`, 'warning');
            }
        }

        function removeProductRow(rowId) {
            const row = document.getElementById(`product-row-${rowId}`);
            row.style.transform = 'translateX(-100%)';
            row.style.opacity = '0';
            setTimeout(() => {
                row.remove();
                orderProducts = orderProducts.filter(p => p.rowId !== rowId);
                
                if (orderProducts.length === 0) {
                    document.getElementById('emptyState').classList.remove('hidden');
                }
                calculateTotal();
            }, 300);
        }

        function calculateTotal() {
            let subtotal = 0;
            
            orderProducts.forEach(item => {
                const qtyInput = document.getElementById(`qty-${item.rowId}`);
                if (qtyInput) {
                    const qty = parseInt(qtyInput.value) || 0;
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        const lineTotal = product.price * qty;
                        
                        const totalEl = document.getElementById(`total-${item.rowId}`);
                        if (totalEl) {
                            totalEl.textContent = `€${lineTotal.toFixed(2)}`;
                        }
                        subtotal += lineTotal;
                    }
                }
            });
            
            // Calculate discount
            let discount = 0;
            if (currentPromocode) {
                if (currentPromocode.type === 'fixed') {
                    discount = currentPromocode.value;
                } else {
                    discount = subtotal * (currentPromocode.value / 100);
                }
                // Ensure discount doesn't exceed subtotal
                if (discount > subtotal) discount = subtotal;
            }
            
            const total = subtotal - discount;
            
            // Update display
            document.getElementById('subtotal').textContent = '€' + subtotal.toFixed(2).replace('.', ',');
            
            const discountRow = document.getElementById('discountRow');
            if (discount > 0) {
                discountRow.classList.remove('hidden');
                document.getElementById('promocodeName').textContent = currentPromocode.code;
                document.getElementById('discountAmount').textContent = '-€' + discount.toFixed(2).replace('.', ',');
            } else {
                discountRow.classList.add('hidden');
            }
            
            document.getElementById('total').textContent = '€' + total.toFixed(2).replace('.', ',');
            
            // Update customer level info (XP te verdienen)
            const customerSelect = document.getElementById('customerSelect');
            if (customerSelect.value && customerSelect.value !== 'new') {
                renderCustomerLevelInfo(parseInt(customerSelect.value));
            }
        }

        // Bereken subtotaal (zonder korting)
        function calculateSubtotal() {
            let subtotal = 0;
            orderProducts.forEach(item => {
                const qtyInput = document.getElementById(`qty-${item.rowId}`);
                if (qtyInput) {
                    const qty = parseInt(qtyInput.value) || 0;
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        subtotal += product.price * qty;
                    }
                }
            });
            return subtotal;
        }

        // FIXED: Proper order submission with WhatsApp notification
        function handleOrderSubmit(e) {
            e.preventDefault();
            
            if (orderProducts.length === 0) {
                showToast('Fout', 'Voeg minimaal één product toe', 'error');
                return;
            }
            
            const customerSelect = document.getElementById('customerSelect');
            if (!customerSelect.value) {
                showToast('Fout', 'Selecteer een klant', 'error');
                return;
            }
            
            let customerId;
            let customerName;
            let isNewCustomer = false;
            
            if (customerSelect.value === 'new') {
                const newCustomerName = document.getElementById('newCustomerName').value;
                const newCustomerEmail = document.getElementById('newCustomerEmail').value;
                
                if (!newCustomerName || !newCustomerEmail) {
                    showToast('Fout', 'Vul naam en email in voor nieuwe klant', 'error');
                    return;
                }
                
                const newCustomer = {
                    id: nextId.customer++,
                    name: newCustomerName,
                    email: newCustomerEmail,
                    phone: document.getElementById('newCustomerPhone').value,
                    address: document.getElementById('newCustomerAddress').value,
                    number: 'CUST-' + String(nextId.customer).padStart(3, '0'),
                    createdAt: new Date().toISOString()
                };
                customers.push(newCustomer);
                customerId = newCustomer.id;
                customerName = newCustomer.name;
                isNewCustomer = true;
                saveData();
                renderCustomers();
                updateSelects();
                updateStats();
            } else {
                customerId = parseInt(customerSelect.value);
                const customer = customers.find(c => c.id === customerId);
                customerName = customer ? customer.name : 'Onbekend';
            }
            
            const btn = e.target.querySelector('button[type="submit"]');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<div class="spinner"></div>';
            btn.disabled = true;
            
            setTimeout(() => {
                // Build order items with full details
                const orderItems = [];
                let subtotal = 0;
                
                orderProducts.forEach(item => {
                    const qtyInput = document.getElementById(`qty-${item.rowId}`);
                    const qty = parseInt(qtyInput.value) || 0;
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        orderItems.push({
                            productId: product.id,
                            productName: product.name,
                            price: product.price,
                            quantity: qty,
                            total: product.price * qty
                        });
                        subtotal += product.price * qty;
                        
                        // Update stock
                        product.stock -= qty;
                    }
                });
                
                // Calculate discount
                let discount = 0;
                let promocodeCode = null;
                let isKenzieCode = false;
                
                if (currentPromocode) {
                    promocodeCode = currentPromocode.code;
                    
                    // Special "kenzie" code - 100% discount for personal use
                    if (promocodeCode === 'KENZIE') {
                        discount = subtotal; // 100% discount
                        isKenzieCode = true;
                    } else if (currentPromocode.type === 'fixed') {
                        discount = currentPromocode.value;
                    } else {
                        discount = subtotal * (currentPromocode.value / 100);
                    }
                    
                    if (discount > subtotal) discount = subtotal;
                    
                    // Update promocode usage (only for non-kenzie codes)
                    if (!isKenzieCode) {
                        currentPromocode.usageCount = (currentPromocode.usageCount || 0) + 1;
                    }
                }
                
                const total = subtotal - discount;
                const orderId = 'ORD-' + new Date().getFullYear() + '-' + String(nextId.order++).padStart(3, '0');
                
                const newOrder = {
                    id: orderId,
                    customerId: customerId,
                    customerName: customerName,
                    items: orderItems,
                    subtotal: subtotal,
                    discount: discount,
                    promocode: promocodeCode,
                    total: total,
                    timestamp: new Date().toISOString(),
                    date: new Date().toLocaleDateString('nl-NL', { day: 'numeric', month: 'short', year: 'numeric' }),
                    time: new Date().toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' }),
                    status: 'completed'
                };
                
                orders.unshift(newOrder); // Add to beginning of array
                saveData();
                
                // Add XP to customer
                const productCount = orderItems.length;
                const xpEarned = calculateOrderXP(customerId, total, productCount);
                addXPToCustomer(customerId, xpEarned);
                
                // Send WhatsApp notification
                if (settings.whatsapp) {
                    sendWhatsAppNotification(newOrder);
                }
                
                btn.innerHTML = originalContent;
                btn.disabled = false;
                showToast('Succes', 'Bestelling geplaatst!', 'success');
                resetForm();
                renderOrders();
                renderProducts();
                renderInventory();
                renderPromocodes();
                updateStats();
                updateAnalytics();
            }, 1500);
        }

        // WhatsApp Notification
        function sendWhatsAppNotification(order) {
            const phoneNumber = settings.whatsappNumber.replace(/\D/g, '');
            
            let itemsText = order.items.map(item => 
                `- ${item.productName} x${item.quantity} = €${item.total.toFixed(2)}`
            ).join('%0A');
            
            let discountText = '';
            if (order.discount > 0) {
                const isKenzie = order.promocode === 'KENZIE';
                discountText = `%0A🏷️ Korting (${order.promocode}${isKenzie ? ' - Persoonlijk' : ''}): -€${order.discount.toFixed(2)}`;
            }
            
            const message = `🛒 *NIEUWE BESTELLING* 🛒%0A%0A` +
                `📋 Bestelnummer: ${order.id}%0A` +
                `👤 Klant: ${order.customerName}%0A` +
                `📅 Datum: ${order.date} ${order.time}%0A%0A` +
                `📦 *Producten:*%0A${itemsText}%0A` +
                `%0A💰 Subtotaal: €${order.subtotal.toFixed(2)}` +
                discountText +
                `%0A%0A💵 *Totaal: €${order.total.toFixed(2)}*`;
            
            // Open WhatsApp with pre-filled message
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${message}`;
            
            // Open in new tab
            window.open(whatsappUrl, '_blank');
        }

        function testWhatsApp() {
            const phoneNumber = document.getElementById('whatsappNumber').value;
            settings.whatsappNumber = phoneNumber;
            saveData();
            
            const cleanNumber = phoneNumber.replace(/\D/g, '');
            const testMessage = `🧪 *Test bericht van Kenzie Business Hub*%0A%0AJe WhatsApp notificaties zijn correct geconfigureerd! ✅`;
            window.open(`https://wa.me/${cleanNumber}?text=${testMessage}`, '_blank');
        }

        // Render Orders
        function renderOrders() {
            const container = document.getElementById('recentOrdersList');
            if (orders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <h4 class="text-lg font-medium text-white mb-2">Nog geen bestellingen</h4>
                        <p class="text-sm text-gray-400 mb-4">Je eerste bestelling verschijnt hier</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = orders.slice(0, 10).map(order => `
                <div class="order-card glass rounded-xl p-4 mb-3 cursor-pointer" onclick="showOrderDetails('${order.id}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                                <i class="fas fa-shopping-bag text-white"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-medium">${order.id}</h4>
                                <p class="text-sm text-gray-400">${order.customerName} • ${order.date}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-lg font-bold text-gradient">€${order.total.toFixed(2)}</span>
                            ${order.promocode ? `<p class="text-xs ${order.promocode === 'KENZIE' ? 'text-purple-400' : 'text-emerald-400'}"><i class="fas fa-tag mr-1"></i>${order.promocode}${order.promocode === 'KENZIE' ? ' (Pers.)' : ''}</p>` : `<p class="text-xs text-gray-500">${order.items ? order.items.length : 0} producten</p>`}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const content = document.getElementById('orderDetailsContent');
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span class="text-gray-400">Bestelnummer</span>
                        <span class="text-white font-medium">${order.id}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span class="text-gray-400">Klant</span>
                        <span class="text-white font-medium">${order.customerName}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span class="text-gray-400">Datum</span>
                        <span class="text-white font-medium">${order.date} ${order.time || ''}</span>
                    </div>
                    <div class="border-t border-white/10 pt-4">
                        <h4 class="text-white font-medium mb-3">Producten</h4>
                        ${order.items ? order.items.map(item => `
                            <div class="flex justify-between items-center py-2">
                                <span class="text-gray-300">${item.productName} x${item.quantity}</span>
                                <span class="text-white">€${item.total.toFixed(2)}</span>
                            </div>
                        `).join('') : '<p class="text-gray-500">Geen product details</p>'}
                    </div>
                    <div class="border-t border-white/10 pt-4 space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Subtotaal</span>
                            <span class="text-white">€${order.subtotal.toFixed(2)}</span>
                        </div>
                        ${order.discount > 0 ? `
                        <div class="flex justify-between items-center">
                            <span class="${order.promocode === 'KENZIE' ? 'text-purple-400' : 'text-emerald-400'}">Korting (${order.promocode}${order.promocode === 'KENZIE' ? ' - Persoonlijk' : ''})</span>
                            <span class="${order.promocode === 'KENZIE' ? 'text-purple-400' : 'text-emerald-400'}">-€${order.discount.toFixed(2)}</span>
                        </div>
                        ` : ''}
                        <div class="flex justify-between items-center pt-2 border-t border-white/10">
                            <span class="text-lg font-semibold text-white">Totaal</span>
                            <span class="text-2xl font-bold text-gradient">€${order.total.toFixed(2)}</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('orderDetailsModal').classList.add('active');
        }

        function closeOrderDetailsModal() {
            document.getElementById('orderDetailsModal').classList.remove('active');
        }

        function clearAllOrders() {
            if (!confirm('Alle bestellingen wissen? Dit kan niet ongedaan worden!')) return;
            orders = [];
            saveData();
            renderOrders();
            updateStats();
            updateAnalytics();
            showToast('Verwijderd', 'Alle bestellingen gewist', 'info');
        }

        // Analytics
        function updateAnalytics() {
            const analyticsContent = document.getElementById('analyticsContent');
            const analyticsCharts = document.getElementById('analyticsCharts');
            
            if (orders.length === 0) {
                analyticsContent.classList.remove('hidden');
                analyticsCharts.classList.add('hidden');
                return;
            }
            
            analyticsContent.classList.add('hidden');
            analyticsCharts.classList.remove('hidden');
            
            // Calculate total revenue, expenses, and profit
            let totalRevenue = 0;
            let totalExpenses = 0;
            
            orders.forEach(order => {
                // For "kenzie" promocode orders, only count as expense (no profit)
                if (order.promocode === 'KENZIE') {
                    // Only add purchase price as expense, no revenue
                    if (order.items) {
                        order.items.forEach(item => {
                            const product = products.find(p => p.id === item.productId);
                            if (product && product.purchasePrice) {
                                totalExpenses += product.purchasePrice * item.quantity;
                            }
                        });
                    }
                } else {
                    // Normal order - count full revenue and expenses
                    totalRevenue += order.total;
                    if (order.items) {
                        order.items.forEach(item => {
                            const product = products.find(p => p.id === item.productId);
                            if (product && product.purchasePrice) {
                                totalExpenses += product.purchasePrice * item.quantity;
                            }
                        });
                    }
                }
            });
            
            const totalProfit = totalRevenue - totalExpenses;
            const profitMargin = totalRevenue > 0 ? ((totalProfit / totalRevenue) * 100).toFixed(1) : 0;
            
            // Update profit and expenses cards
            document.getElementById('totalProfit').textContent = '€' + totalProfit.toFixed(2).replace('.', ',');
            document.getElementById('totalExpenses').textContent = '€' + totalExpenses.toFixed(2).replace('.', ',');
            document.getElementById('totalRevenue').textContent = '€' + totalRevenue.toFixed(2).replace('.', ',');
            document.getElementById('profitMargin').textContent = profitMargin + '%';
            
            // Check for level achievements
            checkLevelAchievements();
            
            // Sales by day
            const salesByDay = {};
            orders.forEach(order => {
                const date = order.date;
                salesByDay[date] = (salesByDay[date] || 0) + order.total;
            });
            
            const salesByDayHtml = Object.entries(salesByDay)
                .sort((a, b) => new Date(b[0]) - new Date(a[0]))
                .slice(0, 7)
                .map(([date, total]) => `
                    <div class="flex justify-between items-center py-2">
                        <span class="text-gray-300">${date}</span>
                        <span class="text-white font-medium">€${total.toFixed(2)}</span>
                    </div>
                `).join('');
            
            document.getElementById('salesByDay').innerHTML = salesByDayHtml || '<p class="text-gray-500">Geen data</p>';
            
            // Top products
            const productSales = {};
            orders.forEach(order => {
                if (order.items) {
                    order.items.forEach(item => {
                        productSales[item.productName] = (productSales[item.productName] || 0) + item.quantity;
                    });
                }
            });
            
            const topProductsHtml = Object.entries(productSales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([name, qty]) => `
                    <div class="flex justify-between items-center py-2">
                        <span class="text-gray-300">${name}</span>
                        <span class="text-white font-medium">${qty} verkocht</span>
                    </div>
                `).join('');
            
            document.getElementById('topProducts').innerHTML = topProductsHtml || '<p class="text-gray-500">Geen data</p>';
            
            // Weekly summary
            const now = new Date();
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            weekStart.setHours(0, 0, 0, 0);
            
            const weekOrders = orders.filter(o => new Date(o.timestamp) >= weekStart);
            
            // Calculate weekly revenue, expenses and profit
            let weekRevenue = 0;
            let weekExpenses = 0;
            
            weekOrders.forEach(order => {
                if (order.promocode === 'KENZIE') {
                    // For kenzie orders, only count purchase price as expense
                    if (order.items) {
                        order.items.forEach(item => {
                            const product = products.find(p => p.id === item.productId);
                            if (product && product.purchasePrice) {
                                weekExpenses += product.purchasePrice * item.quantity;
                            }
                        });
                    }
                } else {
                    weekRevenue += order.total;
                    if (order.items) {
                        order.items.forEach(item => {
                            const product = products.find(p => p.id === item.productId);
                            if (product && product.purchasePrice) {
                                weekExpenses += product.purchasePrice * item.quantity;
                            }
                        });
                    }
                }
            });
            
            const weekProfit = weekRevenue - weekExpenses;
            const weekProducts = weekOrders.reduce((sum, o) => sum + (o.items ? o.items.length : 0), 0);
            
            const weekStartStr = weekStart.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
            const weekEndStr = now.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
            
            document.getElementById('weeklySummary').innerHTML = `
                <div class="glass rounded-xl p-4 text-center">
                    <p class="text-gray-400 text-sm">Periode</p>
                    <p class="text-white font-medium">${weekStartStr} - ${weekEndStr}</p>
                </div>
                <div class="glass rounded-xl p-4 text-center">
                    <p class="text-gray-400 text-sm">Bestellingen</p>
                    <p class="text-2xl font-bold text-white">${weekOrders.length}</p>
                </div>
                <div class="glass rounded-xl p-4 text-center">
                    <p class="text-gray-400 text-sm">Omzet</p>
                    <p class="text-2xl font-bold text-gradient">€${weekRevenue.toFixed(2)}</p>
                </div>
                <div class="glass rounded-xl p-4 text-center">
                    <p class="text-gray-400 text-sm">Winst</p>
                    <p class="text-2xl font-bold text-emerald-400">€${weekProfit.toFixed(2)}</p>
                </div>
            `;
        }

        // Weekly Report
        function checkWeeklyReport() {
            if (!settings.weeklyReport) return;
            
            const now = new Date();
            const isSunday = now.getDay() === 0;
            const is8PM = now.getHours() === 20 && now.getMinutes() === 0;
            
            if (isSunday && is8PM) {
                const today = now.toDateString();
                if (lastReportDate !== today) {
                    generateWeeklyReport();
                    lastReportDate = today;
                    localStorage.setItem('kenzie_lastReportDate', lastReportDate);
                }
            }
        }

        function generateWeeklyReport() {
            const now = new Date();
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            weekStart.setHours(0, 0, 0, 0);
            
            const weekOrders = orders.filter(o => new Date(o.timestamp) >= weekStart);
            
            // Calculate weekly revenue, expenses and profit
            let weekRevenue = 0;
            let weekExpenses = 0;
            
            weekOrders.forEach(order => {
                if (order.promocode === 'KENZIE') {
                    // For kenzie orders, only count purchase price as expense
                    if (order.items) {
                        order.items.forEach(item => {
                            const product = products.find(p => p.id === item.productId);
                            if (product && product.purchasePrice) {
                                weekExpenses += product.purchasePrice * item.quantity;
                            }
                        });
                    }
                } else {
                    weekRevenue += order.total;
                    if (order.items) {
                        order.items.forEach(item => {
                            const product = products.find(p => p.id === item.productId);
                            if (product && product.purchasePrice) {
                                weekExpenses += product.purchasePrice * item.quantity;
                            }
                        });
                    }
                }
            });
            
            const weekProfit = weekRevenue - weekExpenses;
            const weekProducts = weekOrders.reduce((sum, o) => sum + (o.items ? o.items.reduce((a, i) => a + i.quantity, 0) : 0), 0);
            
            // New customers this week
            const weekCustomers = customers.filter(c => new Date(c.createdAt) >= weekStart);
            
            const weekStartStr = weekStart.toLocaleDateString('nl-NL', { day: 'numeric', month: 'long' });
            const weekEndStr = now.toLocaleDateString('nl-NL', { day: 'numeric', month: 'long', year: 'numeric' });
            
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = `
                <div class="text-center mb-6">
                    <h4 class="text-xl font-bold text-white">Wekelijks Rapport</h4>
                    <p class="text-gray-400">${weekStartStr} - ${weekEndStr}</p>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-gray-400 text-sm">Bestellingen</p>
                        <p class="text-3xl font-bold text-white">${weekOrders.length}</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-gray-400 text-sm">Omzet</p>
                        <p class="text-3xl font-bold text-gradient">€${weekRevenue.toFixed(2)}</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-gray-400 text-sm">Winst</p>
                        <p class="text-3xl font-bold text-emerald-400">€${weekProfit.toFixed(2)}</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-gray-400 text-sm">Uitgaven (Inkoop)</p>
                        <p class="text-3xl font-bold text-rose-400">€${weekExpenses.toFixed(2)}</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-gray-400 text-sm">Producten Verkocht</p>
                        <p class="text-3xl font-bold text-white">${weekProducts}</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-gray-400 text-sm">Nieuwe Klanten</p>
                        <p class="text-3xl font-bold text-white">${weekCustomers.length}</p>
                    </div>
                </div>
                
                ${weekOrders.length > 0 ? `
                <div class="mt-4">
                    <h5 class="text-white font-medium mb-2">Bestellingen deze week</h5>
                    <div class="space-y-2 max-h-40 overflow-y-auto">
                        ${weekOrders.slice(0, 5).map(o => `
                            <div class="flex justify-between items-center py-2 px-3 rounded-lg bg-white/5">
                                <span class="text-gray-300 text-sm">${o.customerName}</span>
                                <span class="text-white font-medium">€${o.total.toFixed(2)}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : '<p class="text-gray-500 text-center">Geen bestellingen deze week</p>'}
            `;
            
            document.getElementById('reportModal').classList.add('active');
            
            // Store current report for WhatsApp
            window.currentReport = {
                period: `${weekStartStr} - ${weekEndStr}`,
                orders: weekOrders.length,
                revenue: weekRevenue,
                profit: weekProfit,
                expenses: weekExpenses,
                products: weekProducts,
                newCustomers: weekCustomers.length
            };
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }

        function sendReportViaWhatsApp() {
            if (!window.currentReport) return;
            
            const phoneNumber = settings.whatsappNumber.replace(/\D/g, '');
            const r = window.currentReport;
            
            const message = `📊 *WEEKELIJKS RAPPORT* 📊%0A%0A` +
                `📅 Periode: ${r.period}%0A%0A` +
                `🛒 Bestellingen: ${r.orders}%0A` +
                `💰 Omzet: €${r.revenue.toFixed(2)}%0A` +
                `💚 Winst: €${r.profit.toFixed(2)}%0A` +
                `🛍️ Uitgaven: €${r.expenses.toFixed(2)}%0A` +
                `📦 Producten verkocht: ${r.products}%0A` +
                `👥 Nieuwe klanten: ${r.newCustomers}%0A%0A` +
                `Powered by Kenzie Business Hub ✅`;
            
            window.open(`https://wa.me/${phoneNumber}?text=${message}`, '_blank');
        }

        // Search
        function setupSearch() {
            const searchInput = document.getElementById('globalSearch');
            const searchResults = document.getElementById('searchResults');
            
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                if (query.length < 2) {
                    searchResults.classList.remove('active');
                    return;
                }

                let html = '';
                
                const matchedCustomers = customers.filter(c => 
                    c.name.toLowerCase().includes(query) || 
                    c.email.toLowerCase().includes(query)
                );

                const matchedProducts = products.filter(p => 
                    p.name.toLowerCase().includes(query) || 
                    p.sku.toLowerCase().includes(query)
                );

                const matchedOrders = orders.filter(o => 
                    o.id.toLowerCase().includes(query) ||
                    o.customerName.toLowerCase().includes(query)
                );

                if (matchedCustomers.length > 0) {
                    html += `<div class="px-3 py-2 text-xs font-semibold text-indigo-400 uppercase tracking-wider bg-indigo-500/10">Klanten</div>`;
                    matchedCustomers.forEach(c => {
                        html += `
                            <div class="px-4 py-3 hover:bg-white/5 cursor-pointer flex items-center gap-3 transition-colors" onclick="switchTab('customers')">
                                <div class="w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-xs text-indigo-300">${c.name.charAt(0)}</div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-white font-medium truncate">${c.name}</p>
                                    <p class="text-xs text-gray-400 truncate">${c.email}</p>
                                </div>
                            </div>
                        `;
                    });
                }

                if (matchedProducts.length > 0) {
                    html += `<div class="px-3 py-2 text-xs font-semibold text-purple-400 uppercase tracking-wider bg-purple-500/10 ${matchedCustomers.length > 0 ? 'mt-2' : ''}">Producten</div>`;
                    matchedProducts.forEach(p => {
                        html += `
                            <div class="px-4 py-3 hover:bg-white/5 cursor-pointer flex items-center gap-3 transition-colors" onclick="switchTab('products')">
                                <div class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center text-xs text-purple-300"><i class="fas fa-box"></i></div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-white font-medium truncate">${p.name}</p>
                                    <p class="text-xs text-gray-400">€${p.price.toFixed(2)}</p>
                                </div>
                            </div>
                        `;
                    });
                }

                if (matchedOrders.length > 0) {
                    html += `<div class="px-3 py-2 text-xs font-semibold text-emerald-400 uppercase tracking-wider bg-emerald-500/10 ${matchedCustomers.length + matchedProducts.length > 0 ? 'mt-2' : ''}">Bestellingen</div>`;
                    matchedOrders.forEach(o => {
                        html += `
                            <div class="px-4 py-3 hover:bg-white/5 cursor-pointer flex items-center gap-3 transition-colors" onclick="switchTab('orders'); showOrderDetails('${o.id}')">
                                <div class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center text-xs text-emerald-300"><i class="fas fa-shopping-bag"></i></div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-white font-medium truncate">${o.id}</p>
                                    <p class="text-xs text-gray-400">${o.customerName} • €${o.total.toFixed(2)}</p>
                                </div>
                            </div>
                        `;
                    });
                }

                if (html === '') {
                    html = `<div class="px-4 py-8 text-center text-gray-400 text-sm">Geen resultaten</div>`;
                }

                document.getElementById('searchResultsList').innerHTML = html;
                searchResults.classList.add('active');
            });

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.relative')) {
                    searchResults.classList.remove('active');
                }
            });
        }

        // Settings
        function toggleSetting(btn, type) {
            const isActive = btn.classList.contains('bg-indigo-500');
            if (isActive) {
                btn.classList.remove('bg-indigo-500');
                btn.classList.add('bg-gray-600');
                btn.querySelector('div').style.transform = 'translateX(-24px)';
                settings[type] = false;
                showToast('Uitgeschakeld', type + ' uit', 'info');
            } else {
                btn.classList.remove('bg-gray-600');
                btn.classList.add('bg-indigo-500');
                btn.querySelector('div').style.transform = 'translateX(0)';
                settings[type] = true;
                showToast('Ingeschakeld', type + ' aan', 'success');
            }
            saveData();
        }

        function backupData() {
            const data = { 
                products, 
                customers, 
                invoices, 
                orders, 
                promocodes,
                profitSplit,
                nextId,
                settings,
                xpSettings,
                customerLevels,
                customerXPData,
                exportDate: new Date().toISOString() 
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `kenzie-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            showToast('Backup', 'Data geëxporteerd', 'success');
        }

        // BACKUP UPLOAD FUNCTIONS
        function handleBackupUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            processBackupFile(file);
        }

        function handleBackupDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
            
            const file = event.dataTransfer.files[0];
            if (file && file.name.endsWith('.json')) {
                processBackupFile(file);
            } else {
                showToast('Fout', 'Alleen JSON bestanden toegestaan', 'error');
            }
        }

        function handleBackupDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.add('dragover');
        }

        function handleBackupDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
        }

        function processBackupFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!confirm('Dit zal alle huidige data vervangen. Doorgaan?')) return;
                    
                    if (data.products) products = data.products;
                    if (data.customers) customers = data.customers;
                    if (data.invoices) invoices = data.invoices;
                    if (data.orders) orders = data.orders;
                    if (data.promocodes) promocodes = data.promocodes;
                    if (data.profitSplit) profitSplit = data.profitSplit;
                    if (data.nextId) nextId = data.nextId;
                    if (data.settings) settings = data.settings;
                    
                    saveData();
                    renderAll();
                    showToast('Succes', 'Backup succesvol hersteld!', 'success');
                } catch (error) {
                    showToast('Fout', 'Ongeldig backup bestand', 'error');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (!confirm('ALLES wissen? Dit kan niet ongedaan worden!')) return;
            products = [];
            customers = [];
            invoices = [];
            orders = [];
            promocodes = [];
            profitSplit = [];
            orderProducts = [];
            achievedLevels = [];
            customerXPData = {};
            localStorage.removeItem('kenzie_achievedLevels');
            localStorage.removeItem('kenzie_customerXP');
            nextId = { product: 1, customer: 1, invoice: 1, order: 1, promocode: 1, profitSplit: 1 };
            saveData();
            renderAll();
            resetForm();
            showToast('Reset', 'Alle data gewist', 'info');
        }

        function exportInventory() {
            if (products.length === 0) {
                showToast('Fout', 'Geen producten om te exporteren', 'error');
                return;
            }
            let csv = 'Product,SKU,Verkoop Prijs,Aankoop Prijs,Voorraad,Minimum,Status\n';
            products.forEach(p => {
                const status = p.stock <= p.minStock ? 'Laag' : 'OK';
                csv += `"${p.name}","${p.sku}",${p.price},${p.purchasePrice || 0},${p.stock},${p.minStock},${status}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `voorraad-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            showToast('Export', 'Voorraad geëxporteerd', 'success');
        }

        // Utilities
        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            const icons = {
                success: '<i class="fas fa-check text-emerald-400"></i>',
                error: '<i class="fas fa-exclamation-circle text-red-400"></i>',
                warning: '<i class="fas fa-exclamation-triangle text-amber-400"></i>',
                info: '<i class="fas fa-info-circle text-blue-400"></i>'
            };
            
            const bgColors = {
                success: 'bg-emerald-500/20',
                error: 'bg-red-500/20',
                warning: 'bg-amber-500/20',
                info: 'bg-blue-500/20'
            };
            
            toastIcon.innerHTML = icons[type];
            toastIcon.className = `w-10 h-10 rounded-full ${bgColors[type]} flex items-center justify-center flex-shrink-0`;
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            toast.classList.add('show');
            setTimeout(() => hideToast(), 4000);
        }

        function hideToast() {
            document.getElementById('toast').classList.remove('show');
        }

        function showNotifications() {
            if (orders.length === 0) {
                showToast('Notificaties', 'Geen nieuwe meldingen', 'info');
            } else {
                showToast('Notificaties', `${orders.length} bestellingen ontvangen`, 'info');
            }
        }

        function showQuickMenu() {
            const choice = prompt('Kies:\n1. Nieuwe Bestelling\n2. Nieuwe Klant\n3. Nieuw Product\n4. Nieuwe Factuur\n5. Nieuwe Promocode\n6. Winstverdeling');
            switch(choice) {
                case '1': switchTab('orders'); break;
                case '2': openCustomerModal(); break;
                case '3': openProductModal(); break;
                case '4': openInvoiceModal(); break;
                case '5': openPromocodeModal(); break;
                case '6': switchTab('profitSplit'); break;
            }
        }

        function resetForm() {
            document.getElementById('orderForm').reset();
            document.getElementById('productList').innerHTML = '';
            document.getElementById('emptyState').classList.remove('hidden');
            document.getElementById('newCustomerFields').classList.add('hidden');
            document.getElementById('customerNumber').value = '';
            document.getElementById('promocodeInput').classList.remove('promo-valid', 'promo-invalid');
            document.getElementById('promocodeStatus').innerHTML = '';
            document.getElementById('discountRow').classList.add('hidden');
            currentPromocode = null;
            orderProducts = [];
            calculateTotal();
        }

        // Modal close on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
                document.getElementById('searchResults').classList.remove('active');
            }
        });

        // ============================================
        // LEVEL SYSTEM - AUTOMATISCHE DOELSTELLINGEN
        // ============================================
        
        // Predefined profit levels (tijdlijn)
        const PROFIT_LEVELS = [
            { level: 1, target: 100, name: 'Starter', icon: 'seedling', color: '#22c55e' },
            { level: 2, target: 250, name: 'Beginner', icon: 'sprout', color: '#84cc16' },
            { level: 3, target: 500, name: 'Doorstarter', icon: 'leaf', color: '#14b8a6' },
            { level: 4, target: 750, name: 'Groeiend', icon: 'tree', color: '#06b6d4' },
            { level: 5, target: 1000, name: 'Ondernemer', icon: 'rocket', color: '#3b82f6' },
            { level: 6, target: 1500, name: 'Professional', icon: 'star', color: '#6366f1' },
            { level: 7, target: 2000, name: 'Expert', icon: 'crown', color: '#8b5cf6' },
            { level: 8, target: 3000, name: 'Meester', icon: 'gem', color: '#a855f7' },
            { level: 9, target: 5000, name: 'Champion', icon: 'trophy', color: '#d946ef' },
            { level: 10, target: 7500, name: 'Legende', icon: 'crown', color: '#f43f5e' },
            { level: 11, target: 10000, name: 'Tycoon', icon: 'gem', color: '#f59e0b' },
            { level: 12, target: 15000, name: 'Mogul', icon: 'crown', color: '#eab308' },
            { level: 13, target: 20000, name: 'Magnate', icon: 'star', color: '#f97316' },
            { level: 14, target: 30000, name: 'Baron', icon: 'crown', color: '#ef4444' },
            { level: 15, target: 50000, name: 'Koning', icon: 'crown', color: '#dc2626' },
            { level: 16, target: 75000, name: 'Keizer', icon: 'crown', color: '#991b1b' },
            { level: 17, target: 100000, name: 'Goddelijk', icon: 'bolt', color: '#fbbf24' }
        ];
        
        // Track which levels have been achieved and notified
        let achievedLevels = JSON.parse(localStorage.getItem('kenzie_achievedLevels')) || [];
        
        function saveAchievedLevels() {
            localStorage.setItem('kenzie_achievedLevels', JSON.stringify(achievedLevels));
        }
        
        function getCurrentProfit() {
            // Calculate total profit from orders (same logic as analytics)
            let totalRevenue = 0;
            let totalExpenses = 0;
            
            orders.forEach(order => {
                if (order.promocode === 'KENZIE') {
                    if (order.items) {
                        order.items.forEach(item => {
                            const product = products.find(p => p.id === item.productId);
                            if (product && product.purchasePrice) {
                                totalExpenses += product.purchasePrice * item.quantity;
                            }
                        });
                    }
                } else {
                    totalRevenue += order.total;
                    if (order.items) {
                        order.items.forEach(item => {
                            const product = products.find(p => p.id === item.productId);
                            if (product && product.purchasePrice) {
                                totalExpenses += product.purchasePrice * item.quantity;
                            }
                        });
                    }
                }
            });
            
            return totalRevenue - totalExpenses;
        }
        
        function getCurrentLevel(profit) {
            for (let i = PROFIT_LEVELS.length - 1; i >= 0; i--) {
                if (profit >= PROFIT_LEVELS[i].target) {
                    return PROFIT_LEVELS[i];
                }
            }
            return null; // Below first level
        }
        
        function getNextLevel(profit) {
            for (let i = 0; i < PROFIT_LEVELS.length; i++) {
                if (profit < PROFIT_LEVELS[i].target) {
                    return PROFIT_LEVELS[i];
                }
            }
            return null; // All levels completed
        }
        
        function checkLevelAchievements() {
            const profit = getCurrentProfit();
            
            PROFIT_LEVELS.forEach(level => {
                if (profit >= level.target && !achievedLevels.includes(level.level)) {
                    achievedLevels.push(level.level);
                    saveAchievedLevels();
                    showConfetti();
                    showToast('🎉 Level Up!', `Gefeliciteerd! Je hebt Level ${level.level} bereikt: ${level.name} (€${level.target})`, 'success');
                }
            });
        }
        
        function renderGoals() {
            const currentLevelCard = document.getElementById('currentLevelCard');
            const levelsTimeline = document.getElementById('levelsTimeline');
            const progressBar = document.getElementById('levelProgressBar');
            const nextLevelProgress = document.getElementById('nextLevelProgress');
            const nextLevelText = document.getElementById('nextLevelText');
            const currentProfitDisplay = document.getElementById('goalsCurrentProfit');
            
            if (!levelsTimeline) return;
            
            const profit = getCurrentProfit();
            const currentLevel = getCurrentLevel(profit);
            const nextLevel = getNextLevel(profit);
            
            // Update current profit display
            if (currentProfitDisplay) {
                currentProfitDisplay.textContent = '€' + profit.toFixed(2).replace('.', ',');
            }
            
            // Update badge with current level
            const badge = document.getElementById('activeGoalsCount');
            if (badge) {
                badge.textContent = currentLevel ? currentLevel.level : '0';
            }
            
            // Render current level card
            if (currentLevelCard) {
                if (currentLevel) {
                    currentLevelCard.innerHTML = `
                        <div class="glass rounded-xl p-6 border-2" style="border-color: ${currentLevel.color}">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="w-16 h-16 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, ${currentLevel.color}, ${adjustColor(currentLevel.color, -40)})">
                                        <i class="fas fa-${currentLevel.icon} text-white text-2xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-400">Huidig Level</p>
                                        <h3 class="text-2xl font-bold text-white">Level ${currentLevel.level}: ${currentLevel.name}</h3>
                                        <p class="text-sm" style="color: ${currentLevel.color}">€${currentLevel.target} behaald!</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <i class="fas fa-check-circle text-4xl" style="color: ${currentLevel.color}"></i>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    currentLevelCard.innerHTML = `
                        <div class="glass rounded-xl p-6 border border-white/10">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="w-16 h-16 rounded-xl bg-gray-600 flex items-center justify-center">
                                        <i class="fas fa-lock text-gray-400 text-2xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-400">Huidig Level</p>
                                        <h3 class="text-2xl font-bold text-white">Nog geen level</h3>
                                        <p class="text-sm text-gray-500">Start met verkopen om levels te unlocken!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            // Update progress bar to next level
            if (nextLevel && progressBar) {
                const prevTarget = currentLevel ? currentLevel.target : 0;
                const progress = ((profit - prevTarget) / (nextLevel.target - prevTarget)) * 100;
                const clampedProgress = Math.max(0, Math.min(100, progress));
                
                progressBar.style.width = clampedProgress + '%';
                nextLevelProgress.textContent = clampedProgress.toFixed(0) + '%';
                nextLevelText.textContent = `Nog €${(nextLevel.target - profit).toFixed(2)} tot Level ${nextLevel.level}: ${nextLevel.name}`;
            } else if (progressBar) {
                // All levels completed
                progressBar.style.width = '100%';
                nextLevelProgress.textContent = '100%';
                nextLevelText.textContent = '🏆 Alle levels behaald! Je bent een legende!';
            }
            
            // Render levels timeline
            levelsTimeline.innerHTML = PROFIT_LEVELS.map(level => {
                const isAchieved = profit >= level.target;
                const isNext = nextLevel && level.level === nextLevel.level;
                const isLocked = profit < level.target;
                
                return `
                    <div class="flex items-center gap-4 p-4 rounded-xl transition-all ${isAchieved ? 'bg-white/10 border' : 'bg-white/5'} ${isNext ? 'border-2 animate-pulse' : 'border border-white/5'}" 
                         style="${isAchieved ? 'border-color: ' + level.color : ''}; ${isNext ? 'border-color: ' + level.color + '; box-shadow: 0 0 20px ' + level.color + '40' : ''}">
                        <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0" 
                             style="background: ${isAchieved ? 'linear-gradient(135deg, ' + level.color + ', ' + adjustColor(level.color, -40) + ')' : isNext ? 'linear-gradient(135deg, ' + level.color + '60, ' + adjustColor(level.color, -40) + '60)' : 'rgba(255,255,255,0.1)'}">
                            <i class="fas fa-${level.icon} ${isAchieved || isNext ? 'text-white' : 'text-gray-500'}"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-semibold ${isAchieved ? 'text-white' : isNext ? 'text-white' : 'text-gray-500'}">
                                        Level ${level.level}: ${level.name}
                                    </h4>
                                    <p class="text-sm ${isAchieved ? '' : 'text-gray-500'}" style="${isAchieved ? 'color: ' + level.color : ''}">
                                        €${level.target}
                                    </p>
                                </div>
                                <div>
                                    ${isAchieved ? `
                                        <span class="px-3 py-1 rounded-full text-xs font-medium" style="background: ${level.color}30; color: ${level.color}">
                                            <i class="fas fa-check mr-1"></i> Behaald!
                                        </span>
                                    ` : isNext ? `
                                        <span class="px-3 py-1 rounded-full text-xs font-medium" style="background: ${level.color}30; color: ${level.color}">
                                            <i class="fas fa-arrow-up mr-1"></i> Volgende
                                        </span>
                                    ` : `
                                        <span class="px-3 py-1 rounded-full bg-gray-700 text-gray-500 text-xs">
                                            <i class="fas fa-lock mr-1"></i> Locked
                                        </span>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Helper function to darken/lighten color
        function adjustColor(color, amount) {
            const hex = color.replace('#', '');
            const r = Math.max(0, Math.min(255, parseInt(hex.substr(0, 2), 16) + amount));
            const g = Math.max(0, Math.min(255, parseInt(hex.substr(2, 2), 16) + amount));
            const b = Math.max(0, Math.min(255, parseInt(hex.substr(4, 2), 16) + amount));
            return '#' + r.toString(16).padStart(2, '0') + g.toString(16).padStart(2, '0') + b.toString(16).padStart(2, '0');
        }
        
        function showConfetti() {
            const colors = ['#facc15', '#60a5fa', '#4ade80', '#c084fc', '#f472b6', '#f87171'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }
        
        // ============================================
        // PROFIT SPLIT FUNCTIONS
        // ============================================
        
        function setupSplitColorSelector() {
            const selector = document.getElementById('splitColorSelector');
            if (!selector) return;
            
            selector.querySelectorAll('.split-color-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    selector.querySelectorAll('.split-color-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById('modalSplitColor').value = btn.dataset.color;
                });
            });
            
            // Select first by default
            selector.querySelector('.split-color-btn').classList.add('active');
        }
        
        function getTotalSplitPercentage() {
            return profitSplit.reduce((sum, split) => sum + split.percentage, 0);
        }
        
        function validateSplitPercentage(value) {
            const currentTotal = getTotalSplitPercentage();
            const available = 100 - currentTotal;
            const hint = document.getElementById('splitPercentageHint');
            
            if (hint) {
                hint.textContent = `Beschikbaar: ${available}%`;
                hint.className = 'text-xs mt-1 ' + (value > available ? 'text-red-400' : 'text-gray-500');
            }
        }
        
        function renderProfitSplit() {
            const list = document.getElementById('profitSplitList');
            const stats = document.getElementById('profitSplitStats');
            const legend = document.getElementById('profitSplitLegend');
            const chart = document.getElementById('profitDonutChart');
            
            if (!list) return;
            
            const totalPercentage = getTotalSplitPercentage();
            const remaining = 100 - totalPercentage;
            
            // Render list
            if (profitSplit.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon" style="width: 60px; height: 60px; font-size: 24px;">
                            <i class="fas fa-list"></i>
                        </div>
                        <p class="text-gray-400">Geen categorieën toegevoegd</p>
                        <button onclick="openProfitSplitModal()" class="btn-primary px-4 py-2 rounded-lg text-white text-sm mt-4">
                            <i class="fas fa-plus mr-2"></i>Categorie Toevoegen
                        </button>
                    </div>
                `;
                stats.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon" style="width: 60px; height: 60px; font-size: 24px;">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <p class="text-gray-400">Geen categorieën toegevoegd</p>
                    </div>
                `;
                if (chart) chart.innerHTML = '';
                if (legend) legend.innerHTML = '';
                document.getElementById('totalProfitSplit').textContent = '0%';
                return;
            }
            
            // Render list
            list.innerHTML = profitSplit.map((split, index) => `
                <div class="flex items-center justify-between p-4 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-4 h-4 rounded-full" style="background-color: ${split.color}"></div>
                        <span class="text-white font-medium">${split.name}</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-2xl font-bold" style="color: ${split.color}">${split.percentage}%</span>
                        <button onclick="deleteProfitSplit(${split.id})" class="p-2 rounded-lg hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-all">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Add remaining if any
            if (remaining > 0) {
                list.innerHTML += `
                    <div class="flex items-center justify-between p-4 rounded-xl bg-white/5 border border-dashed border-white/20">
                        <div class="flex items-center gap-3">
                            <div class="w-4 h-4 rounded-full bg-gray-600"></div>
                            <span class="text-gray-400">Nog toe te wijzen</span>
                        </div>
                        <span class="text-2xl font-bold text-gray-500">${remaining}%</span>
                    </div>
                `;
            }
            
            // Render stats
            stats.innerHTML = profitSplit.map(split => `
                <div class="flex items-center justify-between p-3 rounded-lg bg-white/5">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded-full" style="background-color: ${split.color}"></div>
                        <span class="text-gray-300">${split.name}</span>
                    </div>
                    <span class="text-white font-medium">${split.percentage}%</span>
                </div>
            `).join('');
            
            // Render donut chart
            renderDonutChart();
            
            // Update total
            document.getElementById('totalProfitSplit').textContent = totalPercentage + '%';
            
            // Update simulation
            updateProfitSimulation();
        }
        
        function renderDonutChart() {
            const chart = document.getElementById('profitDonutChart');
            const legend = document.getElementById('profitSplitLegend');
            
            if (!chart || profitSplit.length === 0) return;
            
            const totalPercentage = getTotalSplitPercentage();
            const remaining = 100 - totalPercentage;
            
            let currentAngle = 0;
            const radius = 80;
            const center = 100;
            const holeRadius = 60;
            
            let svgContent = '';
            let legendContent = '';
            
            // Add segments for each split
            profitSplit.forEach((split, index) => {
                const percentage = split.percentage;
                const angle = (percentage / 100) * 360;
                
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;
                
                const x1 = center + radius * Math.cos((startAngle * Math.PI) / 180);
                const y1 = center + radius * Math.sin((startAngle * Math.PI) / 180);
                const x2 = center + radius * Math.cos((endAngle * Math.PI) / 180);
                const y2 = center + radius * Math.sin((endAngle * Math.PI) / 180);
                
                const x3 = center + holeRadius * Math.cos((endAngle * Math.PI) / 180);
                const y3 = center + holeRadius * Math.sin((endAngle * Math.PI) / 180);
                const x4 = center + holeRadius * Math.cos((startAngle * Math.PI) / 180);
                const y4 = center + holeRadius * Math.sin((startAngle * Math.PI) / 180);
                
                const largeArc = angle > 180 ? 1 : 0;
                
                const path = `M ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} L ${x3} ${y3} A ${holeRadius} ${holeRadius} 0 ${largeArc} 0 ${x4} ${y4} Z`;
                
                svgContent += `<path d="${path}" fill="${split.color}" class="donut-segment" title="${split.name}: ${split.percentage}%"/>`;
                
                legendContent += `
                    <div class="legend-item flex items-center justify-between p-2 rounded-lg">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full" style="background-color: ${split.color}"></div>
                            <span class="text-gray-300 text-sm">${split.name}</span>
                        </div>
                        <span class="text-white text-sm font-medium">${split.percentage}%</span>
                    </div>
                `;
                
                currentAngle += angle;
            });
            
            // Add remaining segment if any
            if (remaining > 0) {
                const angle = (remaining / 100) * 360;
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;
                
                const x1 = center + radius * Math.cos((startAngle * Math.PI) / 180);
                const y1 = center + radius * Math.sin((startAngle * Math.PI) / 180);
                const x2 = center + radius * Math.cos((endAngle * Math.PI) / 180);
                const y2 = center + radius * Math.sin((endAngle * Math.PI) / 180);
                
                const x3 = center + holeRadius * Math.cos((endAngle * Math.PI) / 180);
                const y3 = center + holeRadius * Math.sin((endAngle * Math.PI) / 180);
                const x4 = center + holeRadius * Math.cos((startAngle * Math.PI) / 180);
                const y4 = center + holeRadius * Math.sin((startAngle * Math.PI) / 180);
                
                const largeArc = angle > 180 ? 1 : 0;
                
                const path = `M ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} L ${x3} ${y3} A ${holeRadius} ${holeRadius} 0 ${largeArc} 0 ${x4} ${y4} Z`;
                
                svgContent += `<path d="${path}" fill="rgba(255,255,255,0.1)"/>`;
                
                legendContent += `
                    <div class="legend-item flex items-center justify-between p-2 rounded-lg">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-gray-600"></div>
                            <span class="text-gray-500 text-sm">Nog toe te wijzen</span>
                        </div>
                        <span class="text-gray-500 text-sm font-medium">${remaining}%</span>
                    </div>
                `;
            }
            
            chart.innerHTML = svgContent;
            legend.innerHTML = legendContent;
        }
        
        function openProfitSplitModal() {
            const totalPercentage = getTotalSplitPercentage();
            if (totalPercentage >= 100) {
                showToast('Fout', 'Totaal percentage is al 100%', 'error');
                return;
            }
            
            editingSplitId = null;
            document.getElementById('profitSplitModal').querySelector('h3').textContent = 'Nieuwe Categorie';
            document.getElementById('modalSplitName').value = '';
            document.getElementById('modalSplitPercentage').value = '';
            document.getElementById('modalSplitColor').value = '#10b981';
            
            // Reset color selector
            document.querySelectorAll('.split-color-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.split-color-btn').classList.add('active');
            
            // Update hint
            validateSplitPercentage(0);
            
            document.getElementById('profitSplitModal').classList.add('active');
        }
        
        function closeProfitSplitModal() {
            document.getElementById('profitSplitModal').classList.remove('active');
            editingSplitId = null;
        }
        
        function saveProfitSplit(e) {
            e.preventDefault();
            
            const name = document.getElementById('modalSplitName').value;
            const percentage = parseInt(document.getElementById('modalSplitPercentage').value);
            const color = document.getElementById('modalSplitColor').value;
            
            const currentTotal = getTotalSplitPercentage();
            
            if (currentTotal + percentage > 100) {
                showToast('Fout', `Totaal zou ${currentTotal + percentage}% zijn. Maximaal 100% toegestaan.`, 'error');
                return;
            }
            
            const newSplit = {
                id: nextId.profitSplit++,
                name: name,
                percentage: percentage,
                color: color,
                createdAt: new Date().toISOString()
            };
            
            profitSplit.push(newSplit);
            saveData();
            renderProfitSplit();
            closeProfitSplitModal();
            showToast('Succes', 'Categorie toegevoegd!', 'success');
        }
        
        function deleteProfitSplit(id) {
            if (!confirm('Categorie verwijderen?')) return;
            profitSplit = profitSplit.filter(s => s.id !== id);
            saveData();
            renderProfitSplit();
            showToast('Verwijderd', 'Categorie verwijderd', 'info');
        }
        
        function updateProfitSimulation() {
            const amount = parseFloat(document.getElementById('simulationAmount').value) || 0;
            const results = document.getElementById('simulationResults');
            
            if (!results) return;
            
            if (amount <= 0 || profitSplit.length === 0) {
                results.innerHTML = '';
                return;
            }
            
            results.innerHTML = profitSplit.map(split => {
                const value = (amount * split.percentage) / 100;
                return `
                    <div class="flex items-center justify-between py-2 px-3 rounded-lg bg-white/5">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full" style="background-color: ${split.color}"></div>
                            <span class="text-gray-300 text-sm">${split.name}</span>
                        </div>
                        <span class="text-white font-medium">€${value.toFixed(2)}</span>
                    </div>
                `;
            }).join('');
        }
    

        // ============================================
        // KLANTEN XP & LEVELS SYSTEEM
        // ============================================

        // Standaard levels configuratie
        const DEFAULT_CUSTOMER_LEVELS = [
            { id: 1, level: 1, name: 'Starter', xpRequired: 0, rewardType: 'none', rewardValue: 0, rewardDesc: 'Welkom bij ons!' },
            { id: 2, level: 2, name: 'Bronze', xpRequired: 100, rewardType: 'discount_fixed', rewardValue: 5, rewardDesc: '-€5 op je volgende bestelling!' },
            { id: 3, level: 3, name: 'Silver', xpRequired: 250, rewardType: 'discount_fixed', rewardValue: 10, rewardDesc: '-€10 op je volgende bestelling!' },
            { id: 4, level: 4, name: 'Gold', xpRequired: 500, rewardType: 'discount_percentage', rewardValue: 10, rewardDesc: '10% korting op je volgende bestelling!' },
            { id: 5, level: 5, name: 'Platinum', xpRequired: 1000, rewardType: 'discount_fixed', rewardValue: 25, rewardDesc: '-€25 op je volgende bestelling!' },
            { id: 6, level: 6, name: 'Diamond', xpRequired: 2000, rewardType: 'free_shipping', rewardValue: 0, rewardDesc: 'Gratis verzending voor altijd!' }
        ];

        // XP Settings
        let xpSettings = JSON.parse(localStorage.getItem('kenzie_xpSettings')) || {
            xpPerProduct: 25,
            xpFirstPurchase: 50,
            xpReturningBonus: 10,
            multiProductBonus: [
                { productCount: 1, xp: 25 },
                { productCount: 2, xp: 60 },
                { productCount: 3, xp: 90 }
            ]
        };

        // Customer Levels configuratie
        let customerLevels = JSON.parse(localStorage.getItem('kenzie_customerLevels')) || [...DEFAULT_CUSTOMER_LEVELS];

        // Klant XP data (wordt opgeslagen per klant)
        let customerXPData = JSON.parse(localStorage.getItem('kenzie_customerXP')) || {};

        function saveXPSettings() {
            localStorage.setItem('kenzie_xpSettings', JSON.stringify(xpSettings));
        }

        function saveCustomerLevels() {
            localStorage.setItem('kenzie_customerLevels', JSON.stringify(customerLevels));
        }

        function saveCustomerXP() {
            localStorage.setItem('kenzie_customerXP', JSON.stringify(customerXPData));
        }

        // Update XP settings vanuit de UI
        function updateXPSettings() {
            xpSettings.xpPerProduct = parseInt(document.getElementById('xpPerProduct').value) || 25;
            xpSettings.xpFirstPurchase = parseInt(document.getElementById('xpFirstPurchase').value) || 50;
            xpSettings.xpReturningBonus = parseInt(document.getElementById('xpReturningBonus').value) || 10;
            saveXPSettings();
            showToast('Opgeslagen', 'XP instellingen bijgewerkt', 'success');
        }

        // Bereken XP voor een bestelling
        function calculateOrderXP(customerId, orderTotal, productCount) {
            let xp = 0;

            // Basis XP per product (niet per euro!)
            xp += productCount * (xpSettings.xpPerProduct || 25);

            // Multi-product bonus - vind de juiste bonus op basis van aantal producten
            const bonusConfig = xpSettings.multiProductBonus || [];
            // Sorteer aflopend op productCount om de hoogste match te vinden
            const sortedBonus = [...bonusConfig].sort((a, b) => b.productCount - a.productCount);
            let productBonus = 0;
            for (const bonus of sortedBonus) {
                if (productCount >= bonus.productCount) {
                    productBonus = bonus.xp;
                    break;
                }
            }
            xp += productBonus;

            // Check of dit de eerste aankoop is
            const customerOrders = orders.filter(o => o.customerId === customerId);
            if (customerOrders.length === 0) {
                xp += xpSettings.xpFirstPurchase;
            } else {
                // Bonus voor terugkerende klant
                xp += xpSettings.xpReturningBonus;
            }

            return xp;
        }

        // Voeg XP toe aan klant
        function addXPToCustomer(customerId, xp) {
            if (!customerXPData[customerId]) {
                customerXPData[customerId] = { xp: 0, totalOrders: 0, unlockedRewards: [] };
            }

            const oldLevel = getCustomerLevel(customerId);
            customerXPData[customerId].xp += xp;
            customerXPData[customerId].totalOrders++;

            const newLevel = getCustomerLevel(customerId);

            // Check of klant een nieuw level heeft bereikt
            if (newLevel.level > oldLevel.level) {
                // Voeg reward toe aan unlocked rewards
                if (!customerXPData[customerId].unlockedRewards.includes(newLevel.id)) {
                    customerXPData[customerId].unlockedRewards.push(newLevel.id);
                }

                // Toon notificatie
                showToast('🎉 Level Up!', `${getCustomerName(customerId)} heeft Level ${newLevel.level}: ${newLevel.name} bereikt! ${newLevel.rewardDesc}`, 'success');
                showConfetti();
            }

            saveCustomerXP();
        }

        // Get klant naam
        function getCustomerName(customerId) {
            const customer = customers.find(c => c.id === parseInt(customerId));
            return customer ? customer.name : 'Onbekende klant';
        }

        // Get huidig level van klant
        function getCustomerLevel(customerId) {
            const xp = customerXPData[customerId]?.xp || 0;

            // Sorteer levels op xpRequired (aflopend)
            const sortedLevels = [...customerLevels].sort((a, b) => b.xpRequired - a.xpRequired);

            for (const level of sortedLevels) {
                if (xp >= level.xpRequired) {
                    return level;
                }
            }

            return customerLevels[0]; // Return eerste level als default
        }

        // Get volgend level van klant
        function getNextCustomerLevel(customerId) {
            const currentLevel = getCustomerLevel(customerId);
            const nextLevel = customerLevels.find(l => l.level === currentLevel.level + 1);
            return nextLevel || null;
        }

        // Bereken voortgang naar volgend level (0-100%)
        function getLevelProgress(customerId) {
            const currentLevel = getCustomerLevel(customerId);
            const nextLevel = getNextCustomerLevel(customerId);

            if (!nextLevel) return 100; // Max level bereikt

            const xp = customerXPData[customerId]?.xp || 0;
            const xpNeeded = nextLevel.xpRequired - currentLevel.xpRequired;
            const xpProgress = xp - currentLevel.xpRequired;

            return Math.min(100, Math.max(0, (xpProgress / xpNeeded) * 100));
        }

        // Check of klant een reward heeft
        function hasUnlockedReward(customerId) {
            const level = getCustomerLevel(customerId);
            return customerXPData[customerId]?.unlockedRewards?.includes(level.id) || false;
        }

        // Markeer reward als gebruikt
        function useReward(customerId) {
            const level = getCustomerLevel(customerId);
            if (customerXPData[customerId]?.unlockedRewards?.includes(level.id)) {
                customerXPData[customerId].unlockedRewards = customerXPData[customerId].unlockedRewards.filter(id => id !== level.id);
                saveCustomerXP();
            }
        }

        // Render klant level info in bestel formulier
        function renderCustomerLevelInfo(customerId) {
            const container = document.getElementById('customerLevelInfo');
            const xpEarnInfo = document.getElementById('xpEarnInfo');

            if (!customerId || customerId === 'new') {
                container.classList.add('hidden');
                xpEarnInfo.classList.add('hidden');
                return;
            }

            const level = getCustomerLevel(customerId);
            const nextLevel = getNextCustomerLevel(customerId);
            const xp = customerXPData[customerId]?.xp || 0;
            const progress = getLevelProgress(customerId);
            const hasReward = hasUnlockedReward(customerId);

            document.getElementById('customerLevelName').textContent = `Level ${level.level}: ${level.name}`;
            document.getElementById('customerLevelBadge').textContent = `⭐ LVL ${level.level}`;
            document.getElementById('customerXPBar').style.width = `${progress}%`;

            if (nextLevel) {
                document.getElementById('customerXPText').textContent = `${xp} XP / ${nextLevel.xpRequired} XP (nog ${nextLevel.xpRequired - xp} XP)`;
            } else {
                document.getElementById('customerXPText').textContent = `${xp} XP - Max level bereikt! 🎉`;
            }

            // Toon reward info als beschikbaar
            const rewardInfo = document.getElementById('customerRewardInfo');
            const rewardText = document.getElementById('customerRewardText');

            if (hasReward && level.rewardType !== 'none') {
                rewardText.textContent = `Beloning beschikbaar: ${level.rewardDesc}`;
                rewardInfo.classList.remove('hidden');
            } else {
                rewardInfo.classList.add('hidden');
            }

            container.classList.remove('hidden');

            // Toon XP te verdienen
            const subtotal = calculateSubtotal();
            const productCount = orderProducts.length;
            const xpToEarn = calculateOrderXP(customerId, subtotal, productCount);
            document.getElementById('xpEarnText').innerHTML = `Deze klant verdient <strong>${xpToEarn} XP</strong> voor deze bestelling!`;
            xpEarnInfo.classList.remove('hidden');
        }

        // Render Level Configuratie pagina
        function renderLevelConfig() {
            const list = document.getElementById('levelConfigList');
            if (!list) return;

            // Sorteer levels op level nummer
            const sortedLevels = [...customerLevels].sort((a, b) => a.level - b.level);

            if (sortedLevels.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon" style="width: 60px; height: 60px; font-size: 24px;">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <p class="text-gray-400">Geen levels geconfigureerd</p>
                        <button onclick="openAddLevelModal()" class="btn-primary px-4 py-2 rounded-lg text-white text-sm mt-4">
                            <i class="fas fa-plus mr-2"></i>Level Toevoegen
                        </button>
                    </div>
                `;
                return;
            }

            list.innerHTML = sortedLevels.map(level => {
                const rewardIcon = {
                    'discount_fixed': 'fa-euro-sign',
                    'discount_percentage': 'fa-percent',
                    'free_product': 'fa-gift',
                    'free_shipping': 'fa-truck',
                    'none': 'fa-lock'
                }[level.rewardType] || 'fa-lock';

                const rewardColor = {
                    'discount_fixed': 'text-emerald-400',
                    'discount_percentage': 'text-purple-400',
                    'free_product': 'text-amber-400',
                    'free_shipping': 'text-blue-400',
                    'none': 'text-gray-500'
                }[level.rewardType] || 'text-gray-500';

                return `
                    <div class="flex items-center justify-between p-4 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center">
                                <span class="text-white font-bold">${level.level}</span>
                            </div>
                            <div>
                                <h4 class="text-white font-medium">${level.name}</h4>
                                <p class="text-sm text-gray-400">${level.xpRequired} XP nodig</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="text-right">
                                <div class="flex items-center gap-2 ${rewardColor}">
                                    <i class="fas ${rewardIcon}"></i>
                                    <span class="text-sm">${level.rewardDesc}</span>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editLevel(${level.id})" class="p-2 rounded-lg hover:bg-indigo-500/20 text-gray-400 hover:text-indigo-400 transition-all">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteLevel(${level.id})" class="p-2 rounded-lg hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-all">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Update XP settings velden
            document.getElementById('xpPerProduct').value = xpSettings.xpPerProduct || 25;
            document.getElementById('xpFirstPurchase').value = xpSettings.xpFirstPurchase;
            document.getElementById('xpReturningBonus').value = xpSettings.xpReturningBonus;
        }

        // Render Klanten Levels pagina
        function renderCustomerLevels() {
            const overview = document.getElementById('customerLevelsOverview');
            const list = document.getElementById('customerLevelsList');
            if (!overview || !list) return;

            // Bereken statistieken
            const totalCustomers = customers.length;
            const customersWithXP = Object.keys(customerXPData).length;
            const totalXP = Object.values(customerXPData).reduce((sum, data) => sum + data.xp, 0);
            const avgXP = customersWithXP > 0 ? Math.round(totalXP / customersWithXP) : 0;

            // Tel klanten per level
            const levelCounts = {};
            customers.forEach(c => {
                const level = getCustomerLevel(c.id);
                levelCounts[level.level] = (levelCounts[level.level] || 0) + 1;
            });

            // Render overview cards
            overview.innerHTML = `
                <div class="glass rounded-xl p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center">
                            <i class="fas fa-users text-indigo-400"></i>
                        </div>
                        <span class="text-gray-400">Actieve Klanten</span>
                    </div>
                    <h3 class="text-3xl font-bold text-white">${customersWithXP} / ${totalCustomers}</h3>
                    <p class="text-sm text-gray-500 mt-1">hebben XP verdiend</p>
                </div>
                <div class="glass rounded-xl p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-amber-500/20 flex items-center justify-center">
                            <i class="fas fa-star text-amber-400"></i>
                        </div>
                        <span class="text-gray-400">Totaal XP Verdiend</span>
                    </div>
                    <h3 class="text-3xl font-bold text-white">${totalXP.toLocaleString()}</h3>
                    <p class="text-sm text-gray-500 mt-1">XP door alle klanten</p>
                </div>
                <div class="glass rounded-xl p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                            <i class="fas fa-chart-line text-emerald-400"></i>
                        </div>
                        <span class="text-gray-400">Gemiddelde XP</span>
                    </div>
                    <h3 class="text-3xl font-bold text-white">${avgXP.toLocaleString()}</h3>
                    <p class="text-sm text-gray-500 mt-1">XP per klant</p>
                </div>
            `;

            // Render klanten lijst
            if (customers.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <p class="text-gray-400">Nog geen klanten</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = customers.map(customer => {
                const level = getCustomerLevel(customer.id);
                const nextLevel = getNextCustomerLevel(customer.id);
                const xp = customerXPData[customer.id]?.xp || 0;
                const progress = getLevelProgress(customer.id);
                const orders = customerXPData[customer.id]?.totalOrders || 0;

                return `
                    <div class="flex items-center justify-between p-4 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                                <span class="text-white font-bold">${customer.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h4 class="text-white font-medium">${customer.name}</h4>
                                <p class="text-sm text-gray-400">${orders} bestellingen</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-6">
                            <div class="flex-1" style="width: 150px;">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="level-badge">⭐ LVL ${level.level}</span>
                                    <span class="text-xs text-gray-400">${xp} XP</span>
                                </div>
                                <div class="xp-progress-container" style="height: 8px;">
                                    <div class="xp-progress-bar" style="width: ${progress}%"></div>
                                </div>
                                ${nextLevel ? `<p class="text-xs text-gray-500 mt-1">${nextLevel.xpRequired - xp} XP tot ${nextLevel.name}</p>` : '<p class="text-xs text-emerald-400 mt-1">Max level! 🎉</p>'}
                            </div>
                            <div class="text-right">
                                <span class="px-3 py-1 rounded-full text-xs font-medium" style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000;">
                                    ${level.name}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Open level config modal
        function openAddLevelModal() {
            document.getElementById('editingLevelId').value = '';
            document.getElementById('levelModalTitle').textContent = 'Nieuw Level';
            document.getElementById('modalLevelNumber').value = '';
            document.getElementById('modalLevelName').value = '';
            document.getElementById('modalLevelXP').value = '';
            document.getElementById('modalRewardType').value = 'discount_fixed';
            document.getElementById('modalRewardValue').value = '';
            document.getElementById('modalRewardDesc').value = '';
            updateRewardFields();
            document.getElementById('levelConfigModal').classList.add('active');
        }

        // Edit level
        function editLevel(levelId) {
            const level = customerLevels.find(l => l.id === levelId);
            if (!level) return;

            document.getElementById('editingLevelId').value = levelId;
            document.getElementById('levelModalTitle').textContent = 'Level Bewerken';
            document.getElementById('modalLevelNumber').value = level.level;
            document.getElementById('modalLevelName').value = level.name;
            document.getElementById('modalLevelXP').value = level.xpRequired;
            document.getElementById('modalRewardType').value = level.rewardType;
            document.getElementById('modalRewardValue').value = level.rewardValue || '';
            document.getElementById('modalRewardDesc').value = level.rewardDesc;
            updateRewardFields();
            document.getElementById('levelConfigModal').classList.add('active');
        }

        // Update reward fields based on type
        function updateRewardFields() {
            const type = document.getElementById('modalRewardType').value;
            const label = document.getElementById('rewardValueLabel');
            const valueField = document.getElementById('modalRewardValue');

            if (type === 'discount_fixed') {
                label.textContent = 'Korting Bedrag (€)';
                valueField.placeholder = 'bijv. 5';
                valueField.parentElement.classList.remove('hidden');
            } else if (type === 'discount_percentage') {
                label.textContent = 'Korting Percentage (%)';
                valueField.placeholder = 'bijv. 10';
                valueField.parentElement.classList.remove('hidden');
            } else if (type === 'free_product') {
                label.textContent = 'Product Naam';
                valueField.placeholder = 'bijv. Gratis T-shirt';
                valueField.parentElement.classList.remove('hidden');
            } else {
                valueField.parentElement.classList.add('hidden');
            }
        }

        // Save level config
        function saveLevelConfig(e) {
            e.preventDefault();

            const editingId = document.getElementById('editingLevelId').value;
            const levelNum = parseInt(document.getElementById('modalLevelNumber').value);
            const name = document.getElementById('modalLevelName').value;
            const xpRequired = parseInt(document.getElementById('modalLevelXP').value);
            const rewardType = document.getElementById('modalRewardType').value;
            const rewardValue = document.getElementById('modalRewardValue').value;
            const rewardDesc = document.getElementById('modalRewardDesc').value;

            if (editingId) {
                // Update bestaand level
                const index = customerLevels.findIndex(l => l.id === parseInt(editingId));
                if (index !== -1) {
                    customerLevels[index] = {
                        ...customerLevels[index],
                        level: levelNum,
                        name,
                        xpRequired,
                        rewardType,
                        rewardValue: rewardType === 'none' ? 0 : (rewardType === 'free_product' ? rewardValue : parseFloat(rewardValue)),
                        rewardDesc
                    };
                }
            } else {
                // Nieuw level
                const newId = Math.max(...customerLevels.map(l => l.id), 0) + 1;
                customerLevels.push({
                    id: newId,
                    level: levelNum,
                    name,
                    xpRequired,
                    rewardType,
                    rewardValue: rewardType === 'none' ? 0 : (rewardType === 'free_product' ? rewardValue : parseFloat(rewardValue)),
                    rewardDesc
                });
            }

            saveCustomerLevels();
            renderLevelConfig();
            closeLevelConfigModal();
            showToast('Opgeslagen', 'Level configuratie bijgewerkt', 'success');
        }

        // Delete level
        function deleteLevel(levelId) {
            if (!confirm('Weet je zeker dat je dit level wilt verwijderen?')) return;
            customerLevels = customerLevels.filter(l => l.id !== levelId);
            saveCustomerLevels();
            renderLevelConfig();
            showToast('Verwijderd', 'Level verwijderd', 'info');
        }

        // Close level config modal
        function closeLevelConfigModal() {
            document.getElementById('levelConfigModal').classList.remove('active');
        }

        // Reset naar standaard levels
        function resetToDefaultLevels() {
            if (!confirm('Weet je zeker dat je alle levels wilt resetten naar de standaard instellingen?')) return;
            customerLevels = [...DEFAULT_CUSTOMER_LEVELS];
            saveCustomerLevels();
            renderLevelConfig();
            showToast('Reset', 'Levels hersteld naar standaard', 'success');
        }

        // Reset alle klant XP
       function resetAllCustomerXP() {
    if (!confirm('Weet je zeker dat je alle klant XP wilt resetten? Dit kan niet ongedaan worden!')) return;
    customerXPData = {};
    saveCustomerXP();
    renderCustomerLevels();
    showToast('Reset', 'Alle klant XP is gereset', 'info');
}

// ============================================
// LEADERBOARD RESET FUNCTIE
// ============================================

function resetLeaderboardData() {
    if (!confirm('⚠️ WEET JE HET ZEKER?\n\nDit wist alle klant XP, bestellingen en leaderboard data!\n\nDit kan NIET ongedaan worden!')) return;
    if (!confirm('Laatste kans: ALLE data wordt verwijderd. Doorgaan?')) return;
    
    // Reset klant XP data
    customerXPData = {};
    localStorage.removeItem('kenzie_customerXP');
    
    // Reset bestellingen
    orders = [];
    localStorage.setItem('kenzie_orders', JSON.stringify(orders));
    
    // Reset winst levels
    achievedLevels = [];
    localStorage.removeItem('kenzie_achievedLevels');
    
    // Reset order ID
    nextId.order = 1;
    localStorage.setItem('kenzie_nextId', JSON.stringify(nextId));
    
    // Update alle schermen
    renderLeaderboard();
    renderCustomerLevels();
    renderGoals();
    renderOrders();
    updateStats();
    updateAnalytics();
    
    // Toon succes
    showToast('✅ Reset Compleet', 'Leaderboard is volledig gereset', 'success');
}

        // Reset profit goals (bestaande functie overschrijven)
        function resetProfitGoals() {
            if (!confirm('Weet je zeker dat je alle winst levels wilt resetten? Dit kan niet ongedaan worden!')) return;
            achievedLevels = [];
            saveAchievedLevels();
            renderGoals();
            showToast('Reset', 'Alle winst levels zijn gereset', 'info');
        }

        // ============================================
        // MULTI-PRODUCT BONUS XP FUNCTIES
        // ============================================

        // Render multi-product bonus lijst in Level Configuratie
        function renderMultiProductBonusList() {
            const list = document.getElementById('multiProductBonusList');
            if (!list) return;

            const bonuses = xpSettings.multiProductBonus || [];
            
            if (bonuses.length === 0) {
                list.innerHTML = `
                    <div class="empty-state py-6">
                        <div class="empty-state-icon" style="width: 50px; height: 50px; font-size: 20px;">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <p class="text-gray-400 text-sm">Nog geen multi-product bonussen ingesteld</p>
                        <p class="text-xs text-gray-500 mt-1">Voeg bonussen toe om klanten te belonen voor meerdere producten!</p>
                    </div>
                `;
                return;
            }

            // Sorteer op aantal producten (oplopend)
            const sortedBonuses = [...bonuses].sort((a, b) => a.productCount - b.productCount);

            list.innerHTML = sortedBonuses.map((bonus, index) => {
                const originalIndex = bonuses.findIndex(b => b.productCount === bonus.productCount && b.xp === bonus.xp);
                return `
                    <div class="flex items-center justify-between p-4 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-pink-400 to-rose-500 flex items-center justify-center">
                                <span class="text-white font-bold">${bonus.productCount}</span>
                            </div>
                            <div>
                                <h4 class="text-white font-medium">${bonus.productCount} product${bonus.productCount > 1 ? 'en' : ''}</h4>
                                <p class="text-sm text-gray-400">Vanaf ${bonus.productCount} product${bonus.productCount > 1 ? 'en' : ''} in winkelmand</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="text-right">
                                <span class="text-2xl font-bold text-pink-400">+${bonus.xp} XP</span>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editMultiProductBonus(${originalIndex})" class="p-2 rounded-lg hover:bg-indigo-500/20 text-gray-400 hover:text-indigo-400 transition-all">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteMultiProductBonus(${originalIndex})" class="p-2 rounded-lg hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-all">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Open modal voor nieuwe multi-product bonus
        function openAddMultiProductBonusModal() {
            document.getElementById('editingMultiProductIndex').value = '';
            document.getElementById('multiProductModalTitle').textContent = 'Multi-Product Bonus Toevoegen';
            document.getElementById('modalMultiProductCount').value = '';
            document.getElementById('modalMultiProductXP').value = '';
            document.getElementById('multiProductBonusModal').classList.add('active');
        }

        // Edit multi-product bonus
        function editMultiProductBonus(index) {
            const bonuses = xpSettings.multiProductBonus || [];
            if (index < 0 || index >= bonuses.length) return;

            const bonus = bonuses[index];
            document.getElementById('editingMultiProductIndex').value = index;
            document.getElementById('multiProductModalTitle').textContent = 'Multi-Product Bonus Bewerken';
            document.getElementById('modalMultiProductCount').value = bonus.productCount;
            document.getElementById('modalMultiProductXP').value = bonus.xp;
            document.getElementById('multiProductBonusModal').classList.add('active');
        }

        // Save multi-product bonus
        function saveMultiProductBonus(e) {
            e.preventDefault();

            const editingIndex = document.getElementById('editingMultiProductIndex').value;
            const productCount = parseInt(document.getElementById('modalMultiProductCount').value);
            const xp = parseInt(document.getElementById('modalMultiProductXP').value);

            if (!xpSettings.multiProductBonus) {
                xpSettings.multiProductBonus = [];
            }

            // Check of dit aantal producten al bestaat (behalve bij edit)
            const existingIndex = xpSettings.multiProductBonus.findIndex(b => b.productCount === productCount);
            if (existingIndex !== -1 && existingIndex !== parseInt(editingIndex)) {
                showToast('Fout', `Er bestaat al een bonus voor ${productCount} producten`, 'error');
                return;
            }

            if (editingIndex !== '') {
                // Update bestaande bonus
                xpSettings.multiProductBonus[parseInt(editingIndex)] = { productCount, xp };
            } else {
                // Nieuwe bonus
                xpSettings.multiProductBonus.push({ productCount, xp });
            }

            saveXPSettings();
            renderMultiProductBonusList();
            closeMultiProductBonusModal();
            showToast('Opgeslagen', 'Multi-product bonus bijgewerkt', 'success');
        }

        // Delete multi-product bonus
        function deleteMultiProductBonus(index) {
            if (!confirm('Weet je zeker dat je deze bonus wilt verwijderen?')) return;
            
            if (xpSettings.multiProductBonus && xpSettings.multiProductBonus[index]) {
                xpSettings.multiProductBonus.splice(index, 1);
                saveXPSettings();
                renderMultiProductBonusList();
                showToast('Verwijderd', 'Bonus verwijderd', 'info');
            }
        }

        // Close multi-product bonus modal
        function closeMultiProductBonusModal() {
            document.getElementById('multiProductBonusModal').classList.remove('active');
        }

        // Override renderLevelConfig om ook multi-product bonus te renderen
        const originalRenderLevelConfig = renderLevelConfig;
        renderLevelConfig = function() {
            originalRenderLevelConfig();
            renderMultiProductBonusList();
        };

        // ============================================
        // LEADERBOARD FUNCTIES
        // ============================================

        let currentLeaderboardTab = 'xp';

        function switchLeaderboardTab(tab) {
            currentLeaderboardTab = tab;
            
            // Update tab buttons
            const xpBtn = document.getElementById('leaderboardTabXP');
            const buyersBtn = document.getElementById('leaderboardTabBuyers');
            const xpContent = document.getElementById('leaderboardXPContent');
            const buyersContent = document.getElementById('leaderboardBuyersContent');
            
            if (tab === 'xp') {
                xpBtn.classList.add('bg-indigo-500', 'text-white');
                xpBtn.classList.remove('text-gray-400');
                buyersBtn.classList.remove('bg-indigo-500', 'text-white');
                buyersBtn.classList.add('text-gray-400');
                xpContent.classList.remove('hidden');
                buyersContent.classList.add('hidden');
            } else {
                buyersBtn.classList.add('bg-indigo-500', 'text-white');
                buyersBtn.classList.remove('text-gray-400');
                xpBtn.classList.remove('bg-indigo-500', 'text-white');
                xpBtn.classList.add('text-gray-400');
                buyersContent.classList.remove('hidden');
                xpContent.classList.add('hidden');
            }
        }

        function renderLeaderboard() {
            renderXPRanking();
            renderBuyersRanking();
            renderLeaderboardStats();
        }

        function renderXPRanking() {
            const podium = document.getElementById('xpPodium');
            const list = document.getElementById('xpRankingList');
            
            if (!podium || !list) return;

            // Combine customers with their XP data
            const customersWithXP = customers.map(customer => {
                const xpData = customerXPData[customer.id] || { xp: 0, totalOrders: 0 };
                const level = getCustomerLevel(customer.id);
                return {
                    ...customer,
                    xp: xpData.xp,
                    totalOrders: xpData.totalOrders || 0,
                    level: level
                };
            }).filter(c => c.xp > 0).sort((a, b) => b.xp - a.xp);

            if (customersWithXP.length === 0) {
                podium.innerHTML = `
                    <div class="col-span-3 empty-state py-8">
                        <div class="empty-state-icon mx-auto" style="width: 60px; height: 60px; font-size: 24px;">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <p class="text-gray-400">Nog geen XP data beschikbaar</p>
                    </div>
                `;
                list.innerHTML = `
                    <div class="empty-state py-8">
                        <p class="text-gray-400">Nog geen klanten met XP</p>
                    </div>
                `;
                return;
            }

            // Render podium (top 3)
            const top3 = customersWithXP.slice(0, 3);
            const podiumPositions = [1, 0, 2]; // 2nd, 1st, 3rd order for visual
            
            podium.innerHTML = podiumPositions.map((posIndex, i) => {
                const customer = top3[posIndex];
                if (!customer) return '<div></div>';
                
                const rank = posIndex + 1;
                const isFirst = rank === 1;
                const colors = {
                    1: { bg: 'from-yellow-400 to-amber-500', text: 'text-yellow-400', icon: '👑' },
                    2: { bg: 'from-gray-300 to-gray-400', text: 'text-gray-300', icon: '🥈' },
                    3: { bg: 'from-orange-400 to-amber-600', text: 'text-orange-400', icon: '🥉' }
                };
                const color = colors[rank];
                
                return `
                    <div class="flex flex-col items-center ${isFirst ? 'order-2 -mt-4' : 'order-' + (i + 1)}">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br ${color.bg} flex items-center justify-center text-2xl mb-2 shadow-lg ${isFirst ? 'shadow-yellow-400/50 scale-110' : ''}">
                            ${customer.name.charAt(0)}
                        </div>
                        <div class="text-2xl mb-1">${color.icon}</div>
                        <p class="text-white font-semibold text-center text-sm truncate w-full">${customer.name}</p>
                        <p class="${color.text} font-bold">${customer.xp.toLocaleString()} XP</p>
                        <p class="text-xs text-gray-400">Lvl ${customer.level.level}</p>
                    </div>
                `;
            }).join('');

            // Render full list
            list.innerHTML = customersWithXP.map((customer, index) => {
                const rank = index + 1;
                const rankColors = {
                    1: 'text-yellow-400',
                    2: 'text-gray-300',
                    3: 'text-orange-400'
                };
                const rankColor = rankColors[rank] || 'text-gray-500';
                const rankIcon = rank <= 3 ? (rank === 1 ? '👑' : rank === 2 ? '🥈' : '🥉') : `#${rank}`;
                
                return `
                    <div class="flex items-center justify-between p-4 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                                <span class="text-white font-bold">${customer.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h4 class="text-white font-medium">${customer.name}</h4>
                                <p class="text-sm text-gray-400">${customer.totalOrders} bestellingen</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-6">
                            <div class="text-right">
                                <span class="text-2xl font-bold ${rankColor}">${rankIcon}</span>
                            </div>
                            <div class="text-right" style="min-width: 100px;">
                                <p class="text-white font-bold">${customer.xp.toLocaleString()} XP</p>
                                <span class="px-2 py-1 rounded-full text-xs font-medium" style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000;">
                                    ${customer.level.name}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderBuyersRanking() {
            const podium = document.getElementById('buyersPodium');
            const list = document.getElementById('buyersRankingList');
            
            if (!podium || !list) return;

            // Calculate total spent and order count per customer
            const customerStats = {};
            
            orders.forEach(order => {
                if (!customerStats[order.customerId]) {
                    customerStats[order.customerId] = {
                        customerId: order.customerId,
                        customerName: order.customerName,
                        totalSpent: 0,
                        orderCount: 0,
                        totalProducts: 0
                    };
                }
                customerStats[order.customerId].totalSpent += order.total;
                customerStats[order.customerId].orderCount += 1;
                if (order.items) {
                    customerStats[order.customerId].totalProducts += order.items.reduce((sum, item) => sum + item.quantity, 0);
                }
            });

            const sortedBuyers = Object.values(customerStats).sort((a, b) => b.totalSpent - a.totalSpent);

            if (sortedBuyers.length === 0) {
                podium.innerHTML = `
                    <div class="col-span-3 empty-state py-8">
                        <div class="empty-state-icon mx-auto" style="width: 60px; height: 60px; font-size: 24px;">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <p class="text-gray-400">Nog geen bestellingen</p>
                    </div>
                `;
                list.innerHTML = `
                    <div class="empty-state py-8">
                        <p class="text-gray-400">Nog geen kopers</p>
                    </div>
                `;
                return;
            }

            // Render podium (top 3)
            const top3 = sortedBuyers.slice(0, 3);
            const podiumPositions = [1, 0, 2];
            
            podium.innerHTML = podiumPositions.map((posIndex, i) => {
                const buyer = top3[posIndex];
                if (!buyer) return '<div></div>';
                
                const rank = posIndex + 1;
                const isFirst = rank === 1;
                const colors = {
                    1: { bg: 'from-yellow-400 to-amber-500', text: 'text-yellow-400', icon: '👑' },
                    2: { bg: 'from-gray-300 to-gray-400', text: 'text-gray-300', icon: '🥈' },
                    3: { bg: 'from-orange-400 to-amber-600', text: 'text-orange-400', icon: '🥉' }
                };
                const color = colors[rank];
                
                return `
                    <div class="flex flex-col items-center ${isFirst ? 'order-2 -mt-4' : 'order-' + (i + 1)}">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br ${color.bg} flex items-center justify-center text-2xl mb-2 shadow-lg ${isFirst ? 'shadow-yellow-400/50 scale-110' : ''}">
                            ${buyer.customerName.charAt(0)}
                        </div>
                        <div class="text-2xl mb-1">${color.icon}</div>
                        <p class="text-white font-semibold text-center text-sm truncate w-full">${buyer.customerName}</p>
                        <p class="${color.text} font-bold">€${buyer.totalSpent.toFixed(2)}</p>
                        <p class="text-xs text-gray-400">${buyer.orderCount} bestellingen</p>
                    </div>
                `;
            }).join('');

            // Render full list
            list.innerHTML = sortedBuyers.map((buyer, index) => {
                const rank = index + 1;
                const rankColors = {
                    1: 'text-yellow-400',
                    2: 'text-gray-300',
                    3: 'text-orange-400'
                };
                const rankColor = rankColors[rank] || 'text-gray-500';
                const rankIcon = rank <= 3 ? (rank === 1 ? '👑' : rank === 2 ? '🥈' : '🥉') : `#${rank}`;
                
                return `
                    <div class="flex items-center justify-between p-4 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center">
                                <span class="text-white font-bold">${buyer.customerName.charAt(0)}</span>
                            </div>
                            <div>
                                <h4 class="text-white font-medium">${buyer.customerName}</h4>
                                <p class="text-sm text-gray-400">${buyer.orderCount} bestellingen • ${buyer.totalProducts} producten</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-6">
                            <div class="text-right">
                                <span class="text-2xl font-bold ${rankColor}">${rankIcon}</span>
                            </div>
                            <div class="text-right" style="min-width: 100px;">
                                <p class="text-emerald-400 font-bold">€${buyer.totalSpent.toFixed(2)}</p>
                                <p class="text-xs text-gray-400">totaal uitgegeven</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderLeaderboardStats() {
            // Top level
            let topLevel = { level: 0, name: '-' };
            customers.forEach(c => {
                const level = getCustomerLevel(c.id);
                if (level.level > topLevel.level) {
                    topLevel = level;
                }
            });
            document.getElementById('leaderboardTopLevel').textContent = topLevel.name;

            // Active customers (with XP)
            const activeCustomers = Object.keys(customerXPData).length;
            document.getElementById('leaderboardActiveCustomers').textContent = activeCustomers;

            // Total orders
            document.getElementById('leaderboardTotalOrders').textContent = orders.length;

            // Total XP
            const totalXP = Object.values(customerXPData).reduce((sum, data) => sum + (data.xp || 0), 0);
            document.getElementById('leaderboardTotalXP').textContent = totalXP.toLocaleString();
        }
</script>
</body>
</html>